create or replace PROCEDURE "PHA_DTBG_04" (P_CONGTHUC VARCHAR2, TUNGAY_KS IN DATE, DENNGAY_KS IN DATE, TUNGAY_HL IN DATE, DENNGAY_HL IN DATE, DONVI_TIEN number, cur OUT SYS_REFCURSOR) 
AS
   P_CT VARCHAR2(32767);   
   P_SQL_INSERT NVARCHAR2(32767);
   QUERY_STR VARCHAR2(32767);
   QUERY_STR1 VARCHAR2(32767);
   QUERY_STR2 VARCHAR2(32767);
   QUERY_STR3 VARCHAR2(32767);
   QUERY_STR4 VARCHAR2(32767);
   QUERY_STR5 VARCHAR2(32767);
   QUERY_STR6 VARCHAR2(32767);
   QUERY_STR7 VARCHAR2(32767);
   QUERY_STR8 VARCHAR2(32767);
   QUERY_STR9 VARCHAR2(32767);
   QUERY_STR10 CLOB;
   Q_INSERT VARCHAR2(32767);
   Q_INSERT_1 VARCHAR2(32767);
   Q_INSERT_2 VARCHAR2(32767);
   Q_INSERT_3 VARCHAR2(32767);
   Q_INSERT_4 VARCHAR2(32767);
   Q_INSERT_5 VARCHAR2(32767);
   Q_INSERT_6 VARCHAR2(32767);
   Q_INSERT_7 VARCHAR2(32767);
   Q_INSERT_8 VARCHAR2(32767);
   Q_INSERT_9 VARCHAR2(32767);
   NAM_TRUOC VARCHAR2(200); 
   NAM_HIENTAI VARCHAR2(200);
   NAM_SAU VARCHAR2(200);
   BEGIN
        NAM_HIENTAI := TO_CHAR(TUNGAY_HL,'yyyy');
        NAM_TRUOC := REPLACE(TO_CHAR(TO_NUMBER(NAM_HIENTAI, '9999') - 1,'9999'),chr(32),'');
        NAM_SAU := REPLACE(TO_CHAR(TO_NUMBER(NAM_HIENTAI, '9999') + 1,'9999'),chr(32),'');
QUERY_STR:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS FROM
        (SELECT COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS FROM
        (SELECT COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS FROM
        (SELECT COT12.MA_CAP,COT12.MA_CTMTQG,COT12.TEN_CAP,COT12.TEN_CTMTQG,COT12.MA_DVQHNS, COT12.MA_NGUON_NSNN, COT12.MA_CHUONG, COT12.KHVKD, COT12.KLHT, COT3.HOANUNG, COT12.TEN_DVQHNS FROM
        (SELECT COT1.MA_CAP,COT1.MA_CTMTQG,COT1.TEN_CAP,COT1.TEN_CTMTQG,COT1.MA_DVQHNS, COT1.MA_NGUON_NSNN, COT1.MA_CHUONG, COT1.KHVKD, COT2.KLHT,COT1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT1.MA_DVQHNS = COT2.MA_DVQHNS AND COT1.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT1.MA_CHUONG = COT2.MA_CHUONG AND COT1.MA_CAP = COT2.MA_CAP AND COT1.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT1.MA_CAP,COT1.MA_CTMTQG,COT1.TEN_CAP,COT1.TEN_CTMTQG,COT1.MA_DVQHNS, COT1.MA_NGUON_NSNN, COT1.MA_CHUONG, COT1.KHVKD, COT2.KLHT,COT1.TEN_DVQHNS) COT12
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT12.MA_DVQHNS = COT3.MA_DVQHNS AND COT12.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT12.MA_CHUONG = COT3.MA_CHUONG AND COT12.MA_CAP = COT3.MA_CAP AND COT12.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT12.MA_CAP,COT12.MA_CTMTQG,COT12.TEN_CAP,COT12.TEN_CTMTQG,COT12.MA_DVQHNS, COT12.MA_NGUON_NSNN, COT12.MA_CHUONG, COT12.KHVKD, COT12.KLHT, COT3.HOANUNG, COT12.TEN_DVQHNS) COT123
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_CHUONG = COT4.MA_CHUONG AND COT123.MA_CAP = COT4.MA_CAP AND COT123.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS) COT1234
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_CHUONG = COT5.MA_CHUONG AND COT1234.MA_CAP = COT5.MA_CAP AND COT1234.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS) COT12345
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_CHUONG = COT6.MA_CHUONG AND COT12345.MA_CAP = COT6.MA_CAP AND COT12345.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS) COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR1:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS FROM
        (SELECT COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS FROM
        (SELECT COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS FROM
        (SELECT COT12.MA_CAP,COT12.MA_CTMTQG,COT12.TEN_CAP,COT12.TEN_CTMTQG,COT12.MA_DVQHNS, COT12.MA_NGUON_NSNN, COT12.MA_CHUONG, COT12.KHVKD, COT12.KLHT, COT3.HOANUNG, COT12.TEN_DVQHNS FROM
        (SELECT COT2.MA_CAP,COT2.MA_CTMTQG,COT2.TEN_CAP,COT2.TEN_CTMTQG,COT2.MA_DVQHNS, COT2.MA_NGUON_NSNN, COT2.MA_CHUONG, COT1.KHVKD, COT2.KLHT,COT2.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1
        RIGHT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT1.MA_DVQHNS = COT2.MA_DVQHNS AND COT1.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT1.MA_CHUONG = COT2.MA_CHUONG AND COT1.MA_CAP = COT2.MA_CAP AND COT1.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT2.MA_CAP,COT2.MA_CTMTQG,COT2.TEN_CAP,COT2.TEN_CTMTQG,COT2.MA_DVQHNS, COT2.MA_NGUON_NSNN, COT2.MA_CHUONG, COT1.KHVKD, COT2.KLHT,COT2.TEN_DVQHNS) COT12
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT12.MA_DVQHNS = COT3.MA_DVQHNS AND COT12.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT12.MA_CHUONG = COT3.MA_CHUONG AND COT12.MA_CAP = COT3.MA_CAP AND COT12.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT12.MA_CAP,COT12.MA_CTMTQG,COT12.TEN_CAP,COT12.TEN_CTMTQG,COT12.MA_DVQHNS, COT12.MA_NGUON_NSNN, COT12.MA_CHUONG, COT12.KHVKD, COT12.KLHT, COT3.HOANUNG, COT12.TEN_DVQHNS) COT123
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_CHUONG = COT4.MA_CHUONG AND COT123.MA_CAP = COT4.MA_CAP AND COT123.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS) COT1234
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_CHUONG = COT5.MA_CHUONG AND COT1234.MA_CAP = COT5.MA_CAP AND COT1234.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS) COT12345
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_CHUONG = COT6.MA_CHUONG AND COT12345.MA_CAP = COT6.MA_CAP AND COT12345.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR2:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS FROM
        (SELECT COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS FROM
        (SELECT COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS FROM
        (SELECT COT13.MA_CAP,COT13.MA_CTMTQG,COT13.TEN_CAP,COT13.TEN_CTMTQG,COT13.MA_DVQHNS, COT13.MA_NGUON_NSNN, COT13.MA_CHUONG, COT13.KHVKD, COT13.HOANUNG,COT2.KLHT,COT13.TEN_DVQHNS FROM
        (SELECT COT3.MA_CAP,COT3.MA_CTMTQG,COT3.TEN_CAP,COT3.TEN_CTMTQG,COT3.MA_DVQHNS, COT3.MA_NGUON_NSNN, COT3.MA_CHUONG, COT1.KHVKD, COT3.HOANUNG,COT1.TEN_DVQHNS FROM
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT3.MA_DVQHNS = COT1.MA_DVQHNS AND COT3.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT3.MA_CHUONG = COT1.MA_CHUONG AND COT3.MA_CAP = COT1.MA_CAP AND COT3.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT3.MA_CAP,COT3.MA_CTMTQG,COT3.TEN_CAP,COT3.TEN_CTMTQG,COT3.MA_DVQHNS, COT3.MA_NGUON_NSNN, COT3.MA_CHUONG, COT1.KHVKD, COT3.HOANUNG,COT1.TEN_DVQHNS) COT13
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT13.MA_DVQHNS = COT2.MA_DVQHNS AND COT13.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT13.MA_CHUONG = COT2.MA_CHUONG AND COT13.MA_CAP = COT2.MA_CAP AND COT13.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT13.MA_CAP,COT13.MA_CTMTQG,COT13.TEN_CAP,COT13.TEN_CTMTQG,COT13.MA_DVQHNS, COT13.MA_NGUON_NSNN, COT13.MA_CHUONG, COT13.KHVKD, COT13.HOANUNG,COT2.KLHT,COT13.TEN_DVQHNS) COT123
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_CHUONG = COT4.MA_CHUONG AND COT123.MA_CAP = COT4.MA_CAP AND COT123.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT123.MA_CAP,COT123.MA_CTMTQG,COT123.TEN_CAP,COT123.TEN_CTMTQG,COT123.MA_DVQHNS, COT123.MA_NGUON_NSNN, COT123.MA_CHUONG, COT123.KHVKD, COT123.KLHT,COT123.HOANUNG, COT4.KHVNS,COT123.TEN_DVQHNS) COT1234
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_CHUONG = COT5.MA_CHUONG AND COT1234.MA_CAP = COT5.MA_CAP AND COT1234.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS) COT12345
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_CHUONG = COT6.MA_CHUONG AND COT12345.MA_CAP = COT6.MA_CAP AND COT12345.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR3:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS FROM
        (SELECT COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS FROM
        (SELECT COT124.MA_CAP,COT124.MA_CTMTQG,COT124.TEN_CAP,COT124.TEN_CTMTQG,COT124.MA_DVQHNS, COT124.MA_NGUON_NSNN, COT124.MA_CHUONG, COT124.KHVKD, COT124.KLHT,COT124.KHVNS, COT3.HOANUNG, COT124.TEN_DVQHNS FROM
        (SELECT COT14.MA_CAP,COT14.MA_CTMTQG,COT14.TEN_CAP,COT14.TEN_CTMTQG,COT14.MA_DVQHNS, COT14.MA_NGUON_NSNN, COT14.MA_CHUONG, COT14.KHVKD, COT14.KHVNS, COT2.KLHT,COT14.TEN_DVQHNS FROM
        (SELECT COT4.MA_CAP,COT4.MA_CTMTQG,COT4.TEN_CAP,COT4.TEN_CTMTQG,COT4.MA_DVQHNS, COT4.MA_NGUON_NSNN, COT4.MA_CHUONG, COT1.KHVKD, COT4.KHVNS,COT4.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT4.MA_DVQHNS = COT1.MA_DVQHNS AND COT4.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT4.MA_CHUONG = COT1.MA_CHUONG AND COT4.MA_CAP = COT1.MA_CAP AND COT4.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT4.MA_CAP,COT4.MA_CTMTQG,COT4.TEN_CAP,COT4.TEN_CTMTQG,COT4.MA_DVQHNS, COT4.MA_NGUON_NSNN, COT4.MA_CHUONG, COT1.KHVKD, COT4.KHVNS,COT4.TEN_DVQHNS) COT14
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT14.MA_DVQHNS = COT2.MA_DVQHNS AND COT14.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT14.MA_CHUONG = COT2.MA_CHUONG AND COT14.MA_CAP = COT2.MA_CAP AND COT14.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT14.MA_CAP,COT14.MA_CTMTQG,COT14.TEN_CAP,COT14.TEN_CTMTQG,COT14.MA_DVQHNS, COT14.MA_NGUON_NSNN, COT14.MA_CHUONG, COT14.KHVKD, COT14.KHVNS, COT2.KLHT,COT14.TEN_DVQHNS) COT124
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT124.MA_DVQHNS = COT3.MA_DVQHNS AND COT124.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT124.MA_CHUONG = COT3.MA_CHUONG AND COT124.MA_CAP = COT3.MA_CAP AND COT124.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT124.MA_CAP,COT124.MA_CTMTQG,COT124.TEN_CAP,COT124.TEN_CTMTQG,COT124.MA_DVQHNS, COT124.MA_NGUON_NSNN, COT124.MA_CHUONG, COT124.KHVKD, COT124.KLHT,COT124.KHVNS, COT3.HOANUNG, COT124.TEN_DVQHNS) COT1234
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_CHUONG = COT5.MA_CHUONG AND COT1234.MA_CAP = COT5.MA_CAP AND COT1234.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT1234.MA_CAP,COT1234.MA_CTMTQG,COT1234.TEN_CAP,COT1234.TEN_CTMTQG,COT1234.MA_DVQHNS, COT1234.MA_NGUON_NSNN, COT1234.MA_CHUONG, COT1234.KHVKD, COT1234.KLHT,COT1234.HOANUNG,COT1234.KHVNS,COT5.KHDTN,COT1234.TEN_DVQHNS) COT12345
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_CHUONG = COT6.MA_CHUONG AND COT12345.MA_CAP = COT6.MA_CAP AND COT12345.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR4:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS FROM
        (SELECT COT1235.MA_CAP,COT1235.MA_CTMTQG,COT1235.TEN_CAP,COT1235.TEN_CTMTQG,COT1235.MA_DVQHNS, COT1235.MA_NGUON_NSNN, COT1235.MA_CHUONG, COT1235.KHVKD, COT1235.KLHT,COT1235.HOANUNG,COT1235.KHDTN, COT4.KHVNS,COT1235.TEN_DVQHNS FROM
        (SELECT COT125.MA_CAP,COT125.MA_CTMTQG,COT125.TEN_CAP,COT125.TEN_CTMTQG,COT125.MA_DVQHNS, COT125.MA_NGUON_NSNN, COT125.MA_CHUONG, COT125.KHVKD, COT125.KLHT,COT3.HOANUNG, COT125.KHDTN,COT125.TEN_DVQHNS FROM
        (SELECT COT15.MA_CAP,COT15.MA_CTMTQG,COT15.TEN_CAP,COT15.TEN_CTMTQG,COT15.MA_DVQHNS, COT15.MA_NGUON_NSNN, COT15.MA_CHUONG, COT15.KHVKD, COT2.KLHT, COT15.KHDTN, COT15.TEN_DVQHNS FROM
        (SELECT COT5.MA_CAP,COT5.MA_CTMTQG,COT5.TEN_CAP,COT5.TEN_CTMTQG,COT5.MA_DVQHNS, COT5.MA_NGUON_NSNN, COT5.MA_CHUONG, COT1.KHVKD, COT5.KHDTN,COT5.TEN_DVQHNS FROM
        (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT5.MA_DVQHNS = COT1.MA_DVQHNS AND COT5.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT5.MA_CHUONG = COT1.MA_CHUONG AND COT5.MA_CAP = COT1.MA_CAP AND COT5.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT5.MA_CAP,COT5.MA_CTMTQG,COT5.TEN_CAP,COT5.TEN_CTMTQG,COT5.MA_DVQHNS, COT5.MA_NGUON_NSNN, COT5.MA_CHUONG, COT1.KHVKD, COT5.KHDTN,COT5.TEN_DVQHNS) COT15
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT15.MA_DVQHNS = COT2.MA_DVQHNS AND COT15.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT15.MA_CHUONG = COT2.MA_CHUONG AND COT15.MA_CAP = COT2.MA_CAP AND COT15.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT15.MA_CAP,COT15.MA_CTMTQG,COT15.TEN_CAP,COT15.TEN_CTMTQG,COT15.MA_DVQHNS, COT15.MA_NGUON_NSNN, COT15.MA_CHUONG, COT15.KHVKD, COT2.KLHT,COT15.KHDTN,COT15.TEN_DVQHNS) COT125
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT125.MA_DVQHNS = COT3.MA_DVQHNS AND COT125.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT125.MA_CHUONG = COT3.MA_CHUONG AND COT125.MA_CAP = COT3.MA_CAP AND COT125.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT125.MA_CAP,COT125.MA_CTMTQG,COT125.TEN_CAP,COT125.TEN_CTMTQG,COT125.MA_DVQHNS, COT125.MA_NGUON_NSNN, COT125.MA_CHUONG, COT125.KHVKD, COT125.KLHT,COT3.HOANUNG, COT125.KHDTN,COT125.TEN_DVQHNS) COT1235
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT1235.MA_DVQHNS = COT4.MA_DVQHNS AND COT1235.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1235.MA_CHUONG = COT4.MA_CHUONG AND COT1235.MA_CAP = COT4.MA_CAP AND COT1235.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT1235.MA_CAP,COT1235.MA_CTMTQG,COT1235.TEN_CAP,COT1235.TEN_CTMTQG,COT1235.MA_DVQHNS, COT1235.MA_NGUON_NSNN, COT1235.MA_CHUONG, COT1235.KHVKD, COT1235.KLHT,COT1235.HOANUNG,COT1235.KHDTN, COT4.KHVNS,COT1235.TEN_DVQHNS) COT12345
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_CHUONG = COT6.MA_CHUONG AND COT12345.MA_CAP = COT6.MA_CAP AND COT12345.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT12345.MA_CAP,COT12345.MA_CTMTQG,COT12345.TEN_CAP,COT12345.TEN_CTMTQG,COT12345.MA_DVQHNS, COT12345.MA_NGUON_NSNN, COT12345.MA_CHUONG, COT12345.KHVKD, COT12345.KLHT,COT12345.HOANUNG,COT12345.KHVNS,COT12345.KHDTN,COT6.KLHTN,COT12345.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR5:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS FROM
        (SELECT COT12346.MA_CAP,COT12346.MA_CTMTQG,COT12346.TEN_CAP,COT12346.TEN_CTMTQG,COT12346.MA_DVQHNS, COT12346.MA_NGUON_NSNN, COT12346.MA_CHUONG, COT12346.KHVKD, COT12346.KLHT,COT12346.HOANUNG,COT12346.KHVNS,COT12346.KLHTN,COT5.KHDTN,COT12346.TEN_DVQHNS FROM
        (SELECT COT1236.MA_CAP,COT1236.MA_CTMTQG,COT1236.TEN_CAP,COT1236.TEN_CTMTQG,COT1236.MA_DVQHNS, COT1236.MA_NGUON_NSNN, COT1236.MA_CHUONG, COT1236.KHVKD, COT1236.KLHT,COT1236.HOANUNG,COT4.KHVNS,COT1236.KLHTN,COT1236.TEN_DVQHNS FROM
        (SELECT COT126.MA_CAP,COT126.MA_CTMTQG,COT126.TEN_CAP,COT126.TEN_CTMTQG,COT126.MA_DVQHNS, COT126.MA_NGUON_NSNN, COT126.MA_CHUONG, COT126.KHVKD, COT126.KLHT,COT3.HOANUNG, COT126.KLHTN,COT126.TEN_DVQHNS FROM
        (SELECT COT16.MA_CAP,COT16.MA_CTMTQG,COT16.TEN_CAP,COT16.TEN_CTMTQG,COT16.MA_DVQHNS, COT16.MA_NGUON_NSNN, COT16.MA_CHUONG, COT16.KHVKD, COT2.KLHT, COT16.KLHTN, COT16.TEN_DVQHNS FROM
        (SELECT COT6.MA_CAP,COT6.MA_CTMTQG,COT6.TEN_CAP,COT6.TEN_CTMTQG,COT6.MA_DVQHNS, COT6.MA_NGUON_NSNN, COT6.MA_CHUONG, COT1.KHVKD, COT6.KLHTN,COT6.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT6.MA_DVQHNS = COT1.MA_DVQHNS AND COT6.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT6.MA_CHUONG = COT1.MA_CHUONG AND COT6.MA_CAP = COT1.MA_CAP AND COT6.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT6.MA_CAP,COT6.MA_CTMTQG,COT6.TEN_CAP,COT6.TEN_CTMTQG,COT6.MA_DVQHNS, COT6.MA_NGUON_NSNN, COT6.MA_CHUONG, COT1.KHVKD, COT6.KLHTN,COT6.TEN_DVQHNS) COT16
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT16.MA_DVQHNS = COT2.MA_DVQHNS AND COT16.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT16.MA_CHUONG = COT2.MA_CHUONG AND COT16.MA_CAP = COT2.MA_CAP AND COT16.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT16.MA_CAP,COT16.MA_CTMTQG,COT16.TEN_CAP,COT16.TEN_CTMTQG,COT16.MA_DVQHNS, COT16.MA_NGUON_NSNN, COT16.MA_CHUONG, COT16.KHVKD, COT2.KLHT, COT16.KLHTN, COT16.TEN_DVQHNS) COT126
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT126.MA_DVQHNS = COT3.MA_DVQHNS AND COT126.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT126.MA_CHUONG = COT3.MA_CHUONG AND COT126.MA_CAP = COT3.MA_CAP AND COT126.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT126.MA_CAP,COT126.MA_CTMTQG,COT126.TEN_CAP,COT126.TEN_CTMTQG,COT126.MA_DVQHNS, COT126.MA_NGUON_NSNN, COT126.MA_CHUONG, COT126.KHVKD, COT126.KLHT,COT3.HOANUNG, COT126.KLHTN,COT126.TEN_DVQHNS) COT1236
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT1236.MA_DVQHNS = COT4.MA_DVQHNS AND COT1236.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1236.MA_CHUONG = COT4.MA_CHUONG AND COT1236.MA_CAP = COT4.MA_CAP AND COT1236.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT1236.MA_CAP,COT1236.MA_CTMTQG,COT1236.TEN_CAP,COT1236.TEN_CTMTQG,COT1236.MA_DVQHNS, COT1236.MA_NGUON_NSNN, COT1236.MA_CHUONG, COT1236.KHVKD, COT1236.KLHT,COT1236.HOANUNG,COT4.KHVNS,COT1236.KLHTN,COT1236.TEN_DVQHNS) COT12346
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT12346.MA_DVQHNS = COT5.MA_DVQHNS AND COT12346.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12346.MA_CHUONG = COT5.MA_CHUONG AND COT12346.MA_CAP = COT5.MA_CAP AND COT12346.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT12346.MA_CAP,COT12346.MA_CTMTQG,COT12346.TEN_CAP,COT12346.TEN_CTMTQG,COT12346.MA_DVQHNS, COT12346.MA_NGUON_NSNN, COT12346.MA_CHUONG, COT12346.KHVKD, COT12346.KLHT,COT12346.HOANUNG,COT12346.KHVNS,COT12346.KLHTN,COT5.KHDTN,COT12346.TEN_DVQHNS) COT123456
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_CHUONG = COT7.MA_CHUONG AND COT123456.MA_CAP = COT7.MA_CAP AND COT123456.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT123456.MA_CAP,COT123456.MA_CTMTQG,COT123456.TEN_CAP,COT123456.TEN_CTMTQG,COT123456.MA_DVQHNS, COT123456.MA_NGUON_NSNN, COT123456.MA_CHUONG, COT123456.KHVKD, COT123456.KLHT,COT123456.HOANUNG,COT123456.KHVNS,COT123456.KHDTN,COT123456.KLHTN,COT7.HOANUNG_NAM,COT123456.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR6:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS FROM
        (SELECT COT123457.MA_CAP,COT123457.MA_CTMTQG,COT123457.TEN_CAP,COT123457.TEN_CTMTQG,COT123457.MA_DVQHNS, COT123457.MA_NGUON_NSNN, COT123457.MA_CHUONG, COT123457.KHVKD, COT123457.KLHT,COT123457.HOANUNG,COT123457.KHVNS,COT123457.KHDTN,COT123457.HOANUNG_NAM,COT6.KLHTN,COT123457.TEN_DVQHNS FROM
        (SELECT COT12347.MA_CAP,COT12347.MA_CTMTQG,COT12347.TEN_CAP,COT12347.TEN_CTMTQG,COT12347.MA_DVQHNS, COT12347.MA_NGUON_NSNN, COT12347.MA_CHUONG, COT12347.KHVKD, COT12347.KLHT,COT12347.HOANUNG,COT12347.KHVNS,COT12347.HOANUNG_NAM,COT5.KHDTN,COT12347.TEN_DVQHNS FROM
        (SELECT COT1237.MA_CAP,COT1237.MA_CTMTQG,COT1237.TEN_CAP,COT1237.TEN_CTMTQG,COT1237.MA_DVQHNS, COT1237.MA_NGUON_NSNN, COT1237.MA_CHUONG, COT1237.KHVKD, COT1237.KLHT,COT1237.HOANUNG,COT1237.HOANUNG_NAM, COT4.KHVNS,COT1237.TEN_DVQHNS FROM
        (SELECT COT127.MA_CAP,COT127.MA_CTMTQG,COT127.TEN_CAP,COT127.TEN_CTMTQG,COT127.MA_DVQHNS, COT127.MA_NGUON_NSNN, COT127.MA_CHUONG, COT127.KHVKD, COT127.KLHT, COT127.HOANUNG_NAM,COT3.HOANUNG, COT127.TEN_DVQHNS FROM
        (SELECT COT17.MA_CAP,COT17.MA_CTMTQG,COT17.TEN_CAP,COT17.TEN_CTMTQG,COT17.MA_DVQHNS, COT17.MA_NGUON_NSNN, COT17.MA_CHUONG, COT17.KHVKD,COT17.HOANUNG_NAM, COT2.KLHT,COT17.TEN_DVQHNS FROM
        (SELECT COT7.MA_CAP,COT7.MA_CTMTQG,COT7.TEN_CAP,COT7.TEN_CTMTQG,COT7.MA_DVQHNS, COT7.MA_NGUON_NSNN, COT7.MA_CHUONG, COT1.KHVKD, COT7.HOANUNG_NAM,COT7.TEN_DVQHNS FROM
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT7.MA_DVQHNS = COT1.MA_DVQHNS AND COT7.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT7.MA_CHUONG = COT1.MA_CHUONG AND COT7.MA_CAP = COT1.MA_CAP AND COT7.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT7.MA_CAP,COT7.MA_CTMTQG,COT7.TEN_CAP,COT7.TEN_CTMTQG,COT7.MA_DVQHNS, COT7.MA_NGUON_NSNN, COT7.MA_CHUONG, COT1.KHVKD, COT7.HOANUNG_NAM,COT7.TEN_DVQHNS) COT17
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT17.MA_DVQHNS = COT2.MA_DVQHNS AND COT17.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT17.MA_CHUONG = COT2.MA_CHUONG AND COT17.MA_CAP = COT2.MA_CAP AND COT17.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT17.MA_CAP,COT17.MA_CTMTQG,COT17.TEN_CAP,COT17.TEN_CTMTQG,COT17.MA_DVQHNS, COT17.MA_NGUON_NSNN, COT17.MA_CHUONG, COT17.KHVKD,COT17.HOANUNG_NAM, COT2.KLHT,COT17.TEN_DVQHNS) COT127
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT127.MA_DVQHNS = COT3.MA_DVQHNS AND COT127.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT127.MA_CHUONG = COT3.MA_CHUONG AND COT127.MA_CAP = COT3.MA_CAP AND COT127.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT127.MA_CAP,COT127.MA_CTMTQG,COT127.TEN_CAP,COT127.TEN_CTMTQG,COT127.MA_DVQHNS, COT127.MA_NGUON_NSNN, COT127.MA_CHUONG, COT127.KHVKD, COT127.KLHT, COT127.HOANUNG_NAM,COT3.HOANUNG, COT127.TEN_DVQHNS) COT1237
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT1237.MA_DVQHNS = COT4.MA_DVQHNS AND COT1237.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1237.MA_CHUONG = COT4.MA_CHUONG AND COT1237.MA_CAP = COT4.MA_CAP AND COT1237.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT1237.MA_CAP,COT1237.MA_CTMTQG,COT1237.TEN_CAP,COT1237.TEN_CTMTQG,COT1237.MA_DVQHNS, COT1237.MA_NGUON_NSNN, COT1237.MA_CHUONG, COT1237.KHVKD, COT1237.KLHT,COT1237.HOANUNG,COT1237.HOANUNG_NAM, COT4.KHVNS,COT1237.TEN_DVQHNS) COT12347
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT12347.MA_DVQHNS = COT5.MA_DVQHNS AND COT12347.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12347.MA_CHUONG = COT5.MA_CHUONG AND COT12347.MA_CAP = COT5.MA_CAP AND COT12347.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT12347.MA_CAP,COT12347.MA_CTMTQG,COT12347.TEN_CAP,COT12347.TEN_CTMTQG,COT12347.MA_DVQHNS, COT12347.MA_NGUON_NSNN, COT12347.MA_CHUONG, COT12347.KHVKD, COT12347.KLHT,COT12347.HOANUNG,COT12347.KHVNS,COT12347.HOANUNG_NAM,COT5.KHDTN,COT12347.TEN_DVQHNS) COT123457
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT123457.MA_DVQHNS = COT6.MA_DVQHNS AND COT123457.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123457.MA_CHUONG = COT6.MA_CHUONG AND COT123457.MA_CAP = COT6.MA_CAP AND COT123457.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT123457.MA_CAP,COT123457.MA_CTMTQG,COT123457.TEN_CAP,COT123457.TEN_CTMTQG,COT123457.MA_DVQHNS, COT123457.MA_NGUON_NSNN, COT123457.MA_CHUONG, COT123457.KHVKD, COT123457.KLHT,COT123457.HOANUNG,COT123457.KHVNS,COT123457.KHDTN,COT123457.HOANUNG_NAM,COT6.KLHTN,COT123457.TEN_DVQHNS) COT1234567
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_CHUONG = COT8.MA_CHUONG AND COT1234567.MA_CAP = COT8.MA_CAP AND COT1234567.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT1234567.MA_CAP,COT1234567.MA_CTMTQG,COT1234567.TEN_CAP,COT1234567.TEN_CTMTQG,COT1234567.MA_DVQHNS, COT1234567.MA_NGUON_NSNN, COT1234567.MA_CHUONG, COT1234567.KHVKD, COT1234567.KLHT,COT1234567.HOANUNG,COT1234567.KHVNS,COT1234567.KHDTN,COT1234567.KLHTN,COT1234567.HOANUNG_NAM,COT8.VTUCTH,COT1234567.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR7:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS FROM
        (SELECT COT1234568.MA_CAP,COT1234568.MA_CTMTQG,COT1234568.TEN_CAP,COT1234568.TEN_CTMTQG,COT1234568.MA_DVQHNS, COT1234568.MA_NGUON_NSNN, COT1234568.MA_CHUONG, COT1234568.KHVKD, COT1234568.KLHT,COT1234568.HOANUNG,COT1234568.KHVNS,COT1234568.KHDTN,COT1234568.KLHTN,COT1234568.VTUCTH,COT7.HOANUNG_NAM,COT1234568.TEN_DVQHNS FROM
        (SELECT COT123458.MA_CAP,COT123458.MA_CTMTQG,COT123458.TEN_CAP,COT123458.TEN_CTMTQG,COT123458.MA_DVQHNS, COT123458.MA_NGUON_NSNN, COT123458.MA_CHUONG, COT123458.KHVKD, COT123458.KLHT,COT123458.HOANUNG,COT123458.KHVNS,COT123458.KHDTN,COT123458.VTUCTH,COT6.KLHTN,COT123458.TEN_DVQHNS FROM
        (SELECT COT12348.MA_CAP,COT12348.MA_CTMTQG,COT12348.TEN_CAP,COT12348.TEN_CTMTQG,COT12348.MA_DVQHNS, COT12348.MA_NGUON_NSNN, COT12348.MA_CHUONG, COT12348.KHVKD, COT12348.KLHT,COT12348.HOANUNG,COT12348.KHVNS,COT12348.VTUCTH,COT5.KHDTN,COT12348.TEN_DVQHNS FROM
        (SELECT COT1238.MA_CAP,COT1238.MA_CTMTQG,COT1238.TEN_CAP,COT1238.TEN_CTMTQG,COT1238.MA_DVQHNS, COT1238.MA_NGUON_NSNN, COT1238.MA_CHUONG, COT1238.KHVKD, COT1238.KLHT,COT1238.HOANUNG,COT1238.VTUCTH,COT4.KHVNS,COT1238.TEN_DVQHNS FROM
        (SELECT COT128.MA_CAP,COT128.MA_CTMTQG,COT128.TEN_CAP,COT128.TEN_CTMTQG,COT128.MA_DVQHNS, COT128.MA_NGUON_NSNN, COT128.MA_CHUONG, COT128.KHVKD, COT128.KLHT,COT128.VTUCTH, COT3.HOANUNG, COT128.TEN_DVQHNS FROM
        (SELECT COT18.MA_CAP,COT18.MA_CTMTQG,COT18.TEN_CAP,COT18.TEN_CTMTQG,COT18.MA_DVQHNS, COT18.MA_NGUON_NSNN, COT18.MA_CHUONG, COT18.KHVKD, COT18.VTUCTH,COT2.KLHT,COT18.TEN_DVQHNS FROM
        (SELECT COT8.MA_CAP,COT8.MA_CTMTQG,COT8.TEN_CAP,COT8.TEN_CTMTQG,COT8.MA_DVQHNS, COT8.MA_NGUON_NSNN, COT8.MA_CHUONG, COT1.KHVKD, COT8.VTUCTH,COT8.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT8.MA_DVQHNS = COT1.MA_DVQHNS AND COT8.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT8.MA_CHUONG = COT1.MA_CHUONG AND COT8.MA_CAP = COT1.MA_CAP AND COT8.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT8.MA_CAP,COT8.MA_CTMTQG,COT8.TEN_CAP,COT8.TEN_CTMTQG,COT8.MA_DVQHNS, COT8.MA_NGUON_NSNN, COT8.MA_CHUONG, COT1.KHVKD, COT8.VTUCTH,COT8.TEN_DVQHNS) COT18
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT18.MA_DVQHNS = COT2.MA_DVQHNS AND COT18.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT18.MA_CHUONG = COT2.MA_CHUONG AND COT18.MA_CAP = COT2.MA_CAP AND COT18.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT18.MA_CAP,COT18.MA_CTMTQG,COT18.TEN_CAP,COT18.TEN_CTMTQG,COT18.MA_DVQHNS, COT18.MA_NGUON_NSNN, COT18.MA_CHUONG, COT18.KHVKD, COT18.VTUCTH,COT2.KLHT,COT18.TEN_DVQHNS) COT128
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT128.MA_DVQHNS = COT3.MA_DVQHNS AND COT128.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT128.MA_CHUONG = COT3.MA_CHUONG AND COT128.MA_CAP = COT3.MA_CAP AND COT128.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT128.MA_CAP,COT128.MA_CTMTQG,COT128.TEN_CAP,COT128.TEN_CTMTQG,COT128.MA_DVQHNS, COT128.MA_NGUON_NSNN, COT128.MA_CHUONG, COT128.KHVKD, COT128.KLHT,COT128.VTUCTH, COT3.HOANUNG, COT128.TEN_DVQHNS) COT1238
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT1238.MA_DVQHNS = COT4.MA_DVQHNS AND COT1238.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1238.MA_CHUONG = COT4.MA_CHUONG AND COT1238.MA_CAP = COT4.MA_CAP AND COT1238.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT1238.MA_CAP,COT1238.MA_CTMTQG,COT1238.TEN_CAP,COT1238.TEN_CTMTQG,COT1238.MA_DVQHNS, COT1238.MA_NGUON_NSNN, COT1238.MA_CHUONG, COT1238.KHVKD, COT1238.KLHT,COT1238.HOANUNG,COT1238.VTUCTH,COT4.KHVNS,COT1238.TEN_DVQHNS) COT12348
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT12348.MA_DVQHNS = COT5.MA_DVQHNS AND COT12348.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12348.MA_CHUONG = COT5.MA_CHUONG AND COT12348.MA_CAP = COT5.MA_CAP AND COT12348.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT12348.MA_CAP,COT12348.MA_CTMTQG,COT12348.TEN_CAP,COT12348.TEN_CTMTQG,COT12348.MA_DVQHNS, COT12348.MA_NGUON_NSNN, COT12348.MA_CHUONG, COT12348.KHVKD, COT12348.KLHT,COT12348.HOANUNG,COT12348.KHVNS,COT12348.VTUCTH,COT5.KHDTN,COT12348.TEN_DVQHNS) COT123458
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT123458.MA_DVQHNS = COT6.MA_DVQHNS AND COT123458.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123458.MA_CHUONG = COT6.MA_CHUONG AND COT123458.MA_CAP = COT6.MA_CAP AND COT123458.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT123458.MA_CAP,COT123458.MA_CTMTQG,COT123458.TEN_CAP,COT123458.TEN_CTMTQG,COT123458.MA_DVQHNS, COT123458.MA_NGUON_NSNN, COT123458.MA_CHUONG, COT123458.KHVKD, COT123458.KLHT,COT123458.HOANUNG,COT123458.KHVNS,COT123458.KHDTN,COT123458.VTUCTH,COT6.KLHTN,COT123458.TEN_DVQHNS) COT1234568
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT1234568.MA_DVQHNS = COT7.MA_DVQHNS AND COT1234568.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT1234568.MA_CHUONG = COT7.MA_CHUONG AND COT1234568.MA_CAP = COT7.MA_CAP AND COT1234568.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT1234568.MA_CAP,COT1234568.MA_CTMTQG,COT1234568.TEN_CAP,COT1234568.TEN_CTMTQG,COT1234568.MA_DVQHNS, COT1234568.MA_NGUON_NSNN, COT1234568.MA_CHUONG, COT1234568.KHVKD, COT1234568.KLHT,COT1234568.HOANUNG,COT1234568.KHVNS,COT1234568.KHDTN,COT1234568.KLHTN,COT1234568.VTUCTH,COT7.HOANUNG_NAM,COT1234568.TEN_DVQHNS) COT12345678
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_CHUONG = COT9.MA_CHUONG AND COT12345678.MA_CAP = COT9.MA_CAP AND COT12345678.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT12345678.MA_CAP,COT12345678.MA_CTMTQG,COT12345678.TEN_CAP,COT12345678.TEN_CTMTQG,COT12345678.MA_DVQHNS, COT12345678.MA_NGUON_NSNN, COT12345678.MA_CHUONG, COT12345678.KHVKD, COT12345678.KLHT,COT12345678.HOANUNG,COT12345678.KHVNS,COT12345678.KHDTN,COT12345678.KLHTN,COT12345678.HOANUNG_NAM,COT12345678.VTUCTH,COT9.KHVKD_NAM,COT12345678.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR8:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS FROM
        (SELECT COT12345679.MA_CAP,COT12345679.MA_CTMTQG,COT12345679.TEN_CAP,COT12345679.TEN_CTMTQG,COT12345679.MA_DVQHNS, COT12345679.MA_NGUON_NSNN, COT12345679.MA_CHUONG, COT12345679.KHVKD, COT12345679.KLHT,COT12345679.HOANUNG,COT12345679.KHVNS,COT12345679.KHDTN,COT12345679.KLHTN,COT12345679.HOANUNG_NAM,COT12345679.KHVKD_NAM,COT8.VTUCTH,COT12345679.TEN_DVQHNS FROM
        (SELECT COT1234569.MA_CAP,COT1234569.MA_CTMTQG,COT1234569.TEN_CAP,COT1234569.TEN_CTMTQG,COT1234569.MA_DVQHNS, COT1234569.MA_NGUON_NSNN, COT1234569.MA_CHUONG, COT1234569.KHVKD, COT1234569.KLHT,COT1234569.HOANUNG,COT1234569.KHVNS,COT1234569.KHDTN,COT1234569.KLHTN,COT1234569.KHVKD_NAM,COT7.HOANUNG_NAM,COT1234569.TEN_DVQHNS FROM
        (SELECT COT123459.MA_CAP,COT123459.MA_CTMTQG,COT123459.TEN_CAP,COT123459.TEN_CTMTQG,COT123459.MA_DVQHNS, COT123459.MA_NGUON_NSNN, COT123459.MA_CHUONG, COT123459.KHVKD, COT123459.KLHT,COT123459.HOANUNG,COT123459.KHVNS,COT123459.KHDTN,COT123459.KHVKD_NAM,COT6.KLHTN,COT123459.TEN_DVQHNS FROM
        (SELECT COT12349.MA_CAP,COT12349.MA_CTMTQG,COT12349.TEN_CAP,COT12349.TEN_CTMTQG,COT12349.MA_DVQHNS, COT12349.MA_NGUON_NSNN, COT12349.MA_CHUONG, COT12349.KHVKD, COT12349.KLHT,COT12349.HOANUNG,COT12349.KHVNS,COT12349.KHVKD_NAM,COT5.KHDTN,COT12349.TEN_DVQHNS FROM
        (SELECT COT1239.MA_CAP,COT1239.MA_CTMTQG,COT1239.TEN_CAP,COT1239.TEN_CTMTQG,COT1239.MA_DVQHNS, COT1239.MA_NGUON_NSNN, COT1239.MA_CHUONG, COT1239.KHVKD, COT1239.KLHT,COT1239.HOANUNG,COT1239.KHVKD_NAM, COT4.KHVNS,COT1239.TEN_DVQHNS FROM
        (SELECT COT129.MA_CAP,COT129.MA_CTMTQG,COT129.TEN_CAP,COT129.TEN_CTMTQG,COT129.MA_DVQHNS, COT129.MA_NGUON_NSNN, COT129.MA_CHUONG, COT129.KHVKD, COT129.KLHT,COT129.KHVKD_NAM, COT3.HOANUNG, COT129.TEN_DVQHNS FROM
        (SELECT COT19.MA_CAP,COT19.MA_CTMTQG,COT19.TEN_CAP,COT19.TEN_CTMTQG,COT19.MA_DVQHNS, COT19.MA_NGUON_NSNN, COT19.MA_CHUONG, COT19.KHVKD,COT19.KHVKD_NAM, COT2.KLHT,COT19.TEN_DVQHNS FROM
        (SELECT COT9.MA_CAP,COT9.MA_CTMTQG,COT9.TEN_CAP,COT9.TEN_CTMTQG,COT9.MA_DVQHNS, COT9.MA_NGUON_NSNN, COT9.MA_CHUONG, COT1.KHVKD, COT9.KHVKD_NAM,COT9.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT9.MA_DVQHNS = COT1.MA_DVQHNS AND COT9.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT9.MA_CHUONG = COT1.MA_CHUONG AND COT9.MA_CAP = COT1.MA_CAP AND COT9.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT9.MA_CAP,COT9.MA_CTMTQG,COT9.TEN_CAP,COT9.TEN_CTMTQG,COT9.MA_DVQHNS, COT9.MA_NGUON_NSNN, COT9.MA_CHUONG, COT1.KHVKD, COT9.KHVKD_NAM,COT9.TEN_DVQHNS) COT19
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT19.MA_DVQHNS = COT2.MA_DVQHNS AND COT19.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT19.MA_CHUONG = COT2.MA_CHUONG AND COT19.MA_CAP = COT2.MA_CAP AND COT19.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT19.MA_CAP,COT19.MA_CTMTQG,COT19.TEN_CAP,COT19.TEN_CTMTQG,COT19.MA_DVQHNS, COT19.MA_NGUON_NSNN, COT19.MA_CHUONG, COT19.KHVKD,COT19.KHVKD_NAM, COT2.KLHT,COT19.TEN_DVQHNS) COT129
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT129.MA_DVQHNS = COT3.MA_DVQHNS AND COT129.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT129.MA_CHUONG = COT3.MA_CHUONG AND COT129.MA_CAP = COT3.MA_CAP AND COT129.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT129.MA_CAP,COT129.MA_CTMTQG,COT129.TEN_CAP,COT129.TEN_CTMTQG,COT129.MA_DVQHNS, COT129.MA_NGUON_NSNN, COT129.MA_CHUONG, COT129.KHVKD, COT129.KLHT,COT129.KHVKD_NAM, COT3.HOANUNG, COT129.TEN_DVQHNS) COT1239
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT1239.MA_DVQHNS = COT4.MA_DVQHNS AND COT1239.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1239.MA_CHUONG = COT4.MA_CHUONG AND COT1239.MA_CAP = COT4.MA_CAP AND COT1239.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT1239.MA_CAP,COT1239.MA_CTMTQG,COT1239.TEN_CAP,COT1239.TEN_CTMTQG,COT1239.MA_DVQHNS, COT1239.MA_NGUON_NSNN, COT1239.MA_CHUONG, COT1239.KHVKD, COT1239.KLHT,COT1239.HOANUNG,COT1239.KHVKD_NAM, COT4.KHVNS,COT1239.TEN_DVQHNS) COT12349
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT12349.MA_DVQHNS = COT5.MA_DVQHNS AND COT12349.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12349.MA_CHUONG = COT5.MA_CHUONG AND COT12349.MA_CAP = COT5.MA_CAP AND COT12349.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT12349.MA_CAP,COT12349.MA_CTMTQG,COT12349.TEN_CAP,COT12349.TEN_CTMTQG,COT12349.MA_DVQHNS, COT12349.MA_NGUON_NSNN, COT12349.MA_CHUONG, COT12349.KHVKD, COT12349.KLHT,COT12349.HOANUNG,COT12349.KHVNS,COT12349.KHVKD_NAM,COT5.KHDTN,COT12349.TEN_DVQHNS) COT123459
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT123459.MA_DVQHNS = COT6.MA_DVQHNS AND COT123459.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123459.MA_CHUONG = COT6.MA_CHUONG AND COT123459.MA_CAP = COT6.MA_CAP AND COT123459.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT123459.MA_CAP,COT123459.MA_CTMTQG,COT123459.TEN_CAP,COT123459.TEN_CTMTQG,COT123459.MA_DVQHNS, COT123459.MA_NGUON_NSNN, COT123459.MA_CHUONG, COT123459.KHVKD, COT123459.KLHT,COT123459.HOANUNG,COT123459.KHVNS,COT123459.KHDTN,COT123459.KHVKD_NAM,COT6.KLHTN,COT123459.TEN_DVQHNS) COT1234569
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT1234569.MA_DVQHNS = COT7.MA_DVQHNS AND COT1234569.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT1234569.MA_CHUONG = COT7.MA_CHUONG AND COT1234569.MA_CAP = COT7.MA_CAP AND COT1234569.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT1234569.MA_CAP,COT1234569.MA_CTMTQG,COT1234569.TEN_CAP,COT1234569.TEN_CTMTQG,COT1234569.MA_DVQHNS, COT1234569.MA_NGUON_NSNN, COT1234569.MA_CHUONG, COT1234569.KHVKD, COT1234569.KLHT,COT1234569.HOANUNG,COT1234569.KHVNS,COT1234569.KHDTN,COT1234569.KLHTN,COT1234569.KHVKD_NAM,COT7.HOANUNG_NAM,COT1234569.TEN_DVQHNS) COT12345679
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT12345679.MA_DVQHNS = COT8.MA_DVQHNS AND COT12345679.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT12345679.MA_CHUONG = COT8.MA_CHUONG AND COT12345679.MA_CAP = COT8.MA_CAP AND COT12345679.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT12345679.MA_CAP,COT12345679.MA_CTMTQG,COT12345679.TEN_CAP,COT12345679.TEN_CTMTQG,COT12345679.MA_DVQHNS, COT12345679.MA_NGUON_NSNN, COT12345679.MA_CHUONG, COT12345679.KHVKD, COT12345679.KLHT,COT12345679.HOANUNG,COT12345679.KHVNS,COT12345679.KHDTN,COT12345679.KLHTN,COT12345679.HOANUNG_NAM,COT12345679.KHVKD_NAM,COT8.VTUCTH,COT12345679.TEN_DVQHNS)COT123456789
        LEFT JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10 ON COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_CHUONG = COT10.MA_CHUONG AND COT123456789.MA_CAP = COT10.MA_CAP AND COT123456789.MA_CTMTQG = COT10.MA_CTMTQG
        GROUP BY COT123456789.MA_CAP,COT123456789.MA_CTMTQG,COT123456789.TEN_CAP,COT123456789.TEN_CTMTQG,COT123456789.MA_DVQHNS, COT123456789.MA_NGUON_NSNN, COT123456789.MA_CHUONG, COT123456789.KHVKD, COT123456789.KLHT,COT123456789.HOANUNG,COT123456789.KHVNS,COT123456789.KHDTN,COT123456789.KLHTN,COT123456789.HOANUNG_NAM,COT123456789.VTUCTH,COT123456789.KHVKD_NAM, COT10.VTUCTH_NAM,COT123456789.TEN_DVQHNS)
       WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
        QUERY_STR9:=' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,NVL(SUM(KHVKD),0) AS KHVKD, NVL(SUM(KLHT-HOANUNG),0) AS KLHT, NVL(SUM(KHVNS),0) AS KHVNS, (NVL(SUM(KHDTN),0)) AS KHDTN, NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN, (NVL(SUM(VTUCTH),0)) AS VTUCTH, (NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM, (NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM FROM 
        (SELECT COT1234567810.MA_CAP,COT1234567810.MA_CTMTQG,COT1234567810.TEN_CAP,COT1234567810.TEN_CTMTQG,COT1234567810.MA_DVQHNS, COT1234567810.MA_NGUON_NSNN, COT1234567810.MA_CHUONG, COT1234567810.KHVKD, COT1234567810.KLHT,COT1234567810.HOANUNG,COT1234567810.KHVNS,COT1234567810.KHDTN,COT1234567810.KLHTN,COT1234567810.HOANUNG_NAM,COT1234567810.VTUCTH, COT1234567810.VTUCTH_NAM,COT9.KHVKD_NAM,COT1234567810.TEN_DVQHNS FROM
        (SELECT COT123456710.MA_CAP,COT123456710.MA_CTMTQG,COT123456710.TEN_CAP,COT123456710.TEN_CTMTQG,COT123456710.MA_DVQHNS, COT123456710.MA_NGUON_NSNN, COT123456710.MA_CHUONG, COT123456710.KHVKD, COT123456710.KLHT,COT123456710.HOANUNG,COT123456710.KHVNS,COT123456710.KHDTN,COT123456710.KLHTN,COT123456710.HOANUNG_NAM, COT123456710.VTUCTH_NAM,COT8.VTUCTH,COT123456710.TEN_DVQHNS FROM
        (SELECT COT12345610.MA_CAP,COT12345610.MA_CTMTQG,COT12345610.TEN_CAP,COT12345610.TEN_CTMTQG,COT12345610.MA_DVQHNS, COT12345610.MA_NGUON_NSNN, COT12345610.MA_CHUONG, COT12345610.KHVKD, COT12345610.KLHT,COT12345610.HOANUNG,COT12345610.KHVNS,COT12345610.KHDTN,COT12345610.KLHTN, COT12345610.VTUCTH_NAM,COT7.HOANUNG_NAM,COT12345610.TEN_DVQHNS FROM
        (SELECT COT1234510.MA_CAP,COT1234510.MA_CTMTQG,COT1234510.TEN_CAP,COT1234510.TEN_CTMTQG,COT1234510.MA_DVQHNS, COT1234510.MA_NGUON_NSNN, COT1234510.MA_CHUONG, COT1234510.KHVKD, COT1234510.KLHT,COT1234510.HOANUNG,COT1234510.KHVNS,COT1234510.KHDTN, COT1234510.VTUCTH_NAM,COT6.KLHTN,COT1234510.TEN_DVQHNS FROM
        (SELECT COT123410.MA_CAP,COT123410.MA_CTMTQG,COT123410.TEN_CAP,COT123410.TEN_CTMTQG,COT123410.MA_DVQHNS, COT123410.MA_NGUON_NSNN, COT123410.MA_CHUONG, COT123410.KHVKD, COT123410.KLHT,COT123410.HOANUNG,COT123410.KHVNS, COT123410.VTUCTH_NAM,COT5.KHDTN,COT123410.TEN_DVQHNS FROM
        (SELECT COT12310.MA_CAP,COT12310.MA_CTMTQG,COT12310.TEN_CAP,COT12310.TEN_CTMTQG,COT12310.MA_DVQHNS, COT12310.MA_NGUON_NSNN, COT12310.MA_CHUONG, COT12310.KHVKD, COT12310.KLHT,COT12310.HOANUNG, COT12310.VTUCTH_NAM, COT4.KHVNS,COT12310.TEN_DVQHNS FROM
        (SELECT COT1210.MA_CAP,COT1210.MA_CTMTQG,COT1210.TEN_CAP,COT1210.TEN_CTMTQG,COT1210.MA_DVQHNS, COT1210.MA_NGUON_NSNN, COT1210.MA_CHUONG, COT1210.KHVKD, COT1210.KLHT, COT1210.VTUCTH_NAM, COT3.HOANUNG, COT1210.TEN_DVQHNS FROM
        (SELECT COT110.MA_CAP,COT110.MA_CTMTQG,COT110.TEN_CAP,COT110.TEN_CTMTQG,COT110.MA_DVQHNS, COT110.MA_NGUON_NSNN, COT110.MA_CHUONG, COT110.KHVKD, COT110.VTUCTH_NAM, COT2.KLHT, COT110.TEN_DVQHNS FROM
        (SELECT COT10.MA_CAP,COT10.MA_CTMTQG,COT10.TEN_CAP,COT10.TEN_CTMTQG,COT10.MA_DVQHNS, COT10.MA_NGUON_NSNN, COT10.MA_CHUONG, COT1.KHVKD, COT10.VTUCTH_NAM,COT10.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT10
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT1 ON COT10.MA_DVQHNS = COT1.MA_DVQHNS AND COT10.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT10.MA_CHUONG = COT1.MA_CHUONG AND COT10.MA_CAP = COT1.MA_CAP AND COT10.MA_CTMTQG = COT1.MA_CTMTQG
        GROUP BY COT10.MA_CAP,COT10.MA_CTMTQG,COT10.TEN_CAP,COT10.TEN_CTMTQG,COT10.MA_DVQHNS, COT10.MA_NGUON_NSNN, COT10.MA_CHUONG, COT1.KHVKD, COT10.VTUCTH_NAM,COT10.TEN_DVQHNS) COT110
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHT, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT2
        ON COT110.MA_DVQHNS = COT2.MA_DVQHNS AND COT110.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT110.MA_CHUONG = COT2.MA_CHUONG AND COT110.MA_CAP = COT2.MA_CAP AND COT110.MA_CTMTQG = COT2.MA_CTMTQG
        GROUP BY COT110.MA_CAP,COT110.MA_CTMTQG,COT110.TEN_CAP,COT110.TEN_CTMTQG,COT110.MA_DVQHNS, COT110.MA_NGUON_NSNN, COT110.MA_CHUONG, COT110.KHVKD, COT110.VTUCTH_NAM, COT2.KLHT, COT110.TEN_DVQHNS) COT1210
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND A.MA_CAP = B.MA_CAP AND A.MA_CTMTQG = B.MA_CTMTQG AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT3 ON COT1210.MA_DVQHNS = COT3.MA_DVQHNS AND COT1210.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1210.MA_CHUONG = COT3.MA_CHUONG AND COT1210.MA_CAP = COT3.MA_CAP AND COT1210.MA_CTMTQG = COT3.MA_CTMTQG
        GROUP BY COT1210.MA_CAP,COT1210.MA_CTMTQG,COT1210.TEN_CAP,COT1210.TEN_CTMTQG,COT1210.MA_DVQHNS, COT1210.MA_NGUON_NSNN, COT1210.MA_CHUONG, COT1210.KHVKD, COT1210.KLHT, COT1210.VTUCTH_NAM, COT3.HOANUNG, COT1210.TEN_DVQHNS) COT12310
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, NVL(SUM(ACCOUNTED_DR),0) AS KHVNS, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT4 
        ON COT12310.MA_DVQHNS = COT4.MA_DVQHNS AND COT12310.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12310.MA_CHUONG = COT4.MA_CHUONG AND COT12310.MA_CAP = COT4.MA_CAP AND COT12310.MA_CTMTQG = COT4.MA_CTMTQG
        GROUP BY COT12310.MA_CAP,COT12310.MA_CTMTQG,COT12310.TEN_CAP,COT12310.TEN_CTMTQG,COT12310.MA_DVQHNS, COT12310.MA_NGUON_NSNN, COT12310.MA_CHUONG, COT12310.KHVKD, COT12310.KLHT,COT12310.HOANUNG, COT12310.VTUCTH_NAM, COT4.KHVNS,COT12310.TEN_DVQHNS) COT123410
        LEFT JOIN 
       (SELECT DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG, (NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN,DK1.TEN_DVQHNS FROM
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK1 FULL JOIN 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS T2, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) DK2 ON DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_CHUONG = DK2.MA_CHUONG AND DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_CAP = DK2.MA_CAP AND DK1.MA_CTMTQG = DK2.MA_CTMTQG
        GROUP BY DK1.MA_CAP,DK1.MA_CTMTQG,DK1.TEN_CAP,DK1.TEN_CTMTQG,DK1.MA_DVQHNS, DK1.MA_NGUON_NSNN, DK1.MA_CHUONG,DK1.TEN_DVQHNS) COT5
        ON COT123410.MA_DVQHNS = COT5.MA_DVQHNS AND COT123410.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123410.MA_CHUONG = COT5.MA_CHUONG AND COT123410.MA_CAP = COT5.MA_CAP AND COT123410.MA_CTMTQG = COT5.MA_CTMTQG
        GROUP BY COT123410.MA_CAP,COT123410.MA_CTMTQG,COT123410.TEN_CAP,COT123410.TEN_CTMTQG,COT123410.MA_DVQHNS, COT123410.MA_NGUON_NSNN, COT123410.MA_CHUONG, COT123410.KHVKD, COT123410.KLHT,COT123410.HOANUNG,COT123410.KHVNS, COT123410.VTUCTH_NAM,COT5.KHDTN,COT123410.TEN_DVQHNS) COT1234510
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
        AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT6
        ON COT1234510.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234510.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234510.MA_CHUONG = COT6.MA_CHUONG AND COT1234510.MA_CAP = COT6.MA_CAP AND COT1234510.MA_CTMTQG = COT6.MA_CTMTQG
        GROUP BY COT1234510.MA_CAP,COT1234510.MA_CTMTQG,COT1234510.TEN_CAP,COT1234510.TEN_CTMTQG,COT1234510.MA_DVQHNS, COT1234510.MA_NGUON_NSNN, COT1234510.MA_CHUONG, COT1234510.KHVKD, COT1234510.KLHT,COT1234510.HOANUNG,COT1234510.KHVNS,COT1234510.KHDTN, COT1234510.VTUCTH_NAM,COT6.KLHTN,COT1234510.TEN_DVQHNS) COT12345610
        LEFT JOIN
        (SELECT CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM, CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS FROM  
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,ACCOUNTED_CR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS,ACCOUNTED_CR)CHI INNER JOIN 
        (SELECT AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR FROM (SELECT A.MA_CAP,A.MA_CTMTQG,A.TEN_CAP,A.TEN_CTMTQG,A.MA_DVQHNS, A.MA_CHUONG, A.MA_NGUON_NSNN, A.TEN_DVQHNS, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN, ACCOUNTED_DR, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
        ON A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_CHUONG = B.MA_CHUONG AND A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
        GROUP BY AB.MA_CAP,AB.MA_CTMTQG,AB.TEN_CAP,AB.TEN_CTMTQG,AB.MA_DVQHNS, AB.MA_CHUONG, AB.MA_NGUON_NSNN, AB.TEN_DVQHNS, AB.ACCOUNTED_DR)DT ON 
        CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_CHUONG = DT.MA_CHUONG AND CHI.MA_CAP = DT.MA_CAP AND CHI.MA_CTMTQG = DT.MA_CTMTQG
        GROUP BY CHI.MA_CAP,CHI.MA_CTMTQG,CHI.TEN_CAP,CHI.TEN_CTMTQG,CHI.MA_DVQHNS, CHI.MA_NGUON_NSNN, CHI.MA_CHUONG, CHI.TEN_DVQHNS) COT7 ON COT12345610.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345610.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345610.MA_CHUONG = COT7.MA_CHUONG AND COT12345610.MA_CAP = COT7.MA_CAP AND COT12345610.MA_CTMTQG = COT7.MA_CTMTQG
        GROUP BY COT12345610.MA_CAP,COT12345610.MA_CTMTQG,COT12345610.TEN_CAP,COT12345610.TEN_CTMTQG,COT12345610.MA_DVQHNS, COT12345610.MA_NGUON_NSNN, COT12345610.MA_CHUONG, COT12345610.KHVKD, COT12345610.KLHT,COT12345610.HOANUNG,COT12345610.KHVNS,COT12345610.KHDTN,COT12345610.KLHTN, COT12345610.VTUCTH_NAM,COT7.HOANUNG_NAM,COT12345610.TEN_DVQHNS) COT123456710
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH, TEN_DVQHNS
        FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT8 ON COT123456710.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456710.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456710.MA_CHUONG = COT8.MA_CHUONG AND COT123456710.MA_CAP = COT8.MA_CAP AND COT123456710.MA_CTMTQG = COT8.MA_CTMTQG
        GROUP BY COT123456710.MA_CAP,COT123456710.MA_CTMTQG,COT123456710.TEN_CAP,COT123456710.TEN_CTMTQG,COT123456710.MA_DVQHNS, COT123456710.MA_NGUON_NSNN, COT123456710.MA_CHUONG, COT123456710.KHVKD, COT123456710.KLHT,COT123456710.HOANUNG,COT123456710.KHVNS,COT123456710.KHDTN,COT123456710.KLHTN,COT123456710.HOANUNG_NAM, COT123456710.VTUCTH_NAM,COT8.VTUCTH,COT123456710.TEN_DVQHNS) COT1234567810
        LEFT JOIN
        (SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN ,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM, TEN_DVQHNS
        FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
        NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_DVQHNS, MA_CHUONG, MA_NGUON_NSNN,TEN_DVQHNS) COT9 ON COT1234567810.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567810.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567810.MA_CHUONG = COT9.MA_CHUONG AND COT1234567810.MA_CAP = COT9.MA_CAP AND COT1234567810.MA_CTMTQG = COT9.MA_CTMTQG
        GROUP BY COT1234567810.MA_CAP,COT1234567810.MA_CTMTQG,COT1234567810.TEN_CAP,COT1234567810.TEN_CTMTQG,COT1234567810.MA_DVQHNS, COT1234567810.MA_NGUON_NSNN, COT1234567810.MA_CHUONG, COT1234567810.KHVKD, COT1234567810.KLHT,COT1234567810.HOANUNG,COT1234567810.KHVNS,COT1234567810.KHDTN,COT1234567810.KLHTN,COT1234567810.HOANUNG_NAM,COT1234567810.VTUCTH, COT1234567810.VTUCTH_NAM,COT9.KHVKD_NAM,COT1234567810.TEN_DVQHNS)
        WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
        GROUP BY MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS, TEN_DVQHNS ';
--       DBMS_OUTPUT.ENABLE (buffer_size => NULL);
--      DBMS_OUTPUT.put_line (QUERY_STR9); 
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_1';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_2';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_3';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_4';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_5';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_6';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_7';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_8';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_9';  
        EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTXDBG04_10'; 

       Q_INSERT:= ' INSERT INTO PHA_DTXDBG04_1 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR||')';
       Q_INSERT_1:= ' INSERT INTO PHA_DTXDBG04_2 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR1||')';
       Q_INSERT_2:= ' INSERT INTO PHA_DTXDBG04_3 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR2||')';
       Q_INSERT_3:= ' INSERT INTO PHA_DTXDBG04_4 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR3||')';
       Q_INSERT_4:= ' INSERT INTO PHA_DTXDBG04_5 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR4||')';
       Q_INSERT_5:= ' INSERT INTO PHA_DTXDBG04_6 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR5||')';
       Q_INSERT_6:= ' INSERT INTO PHA_DTXDBG04_7 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR6||')';
       Q_INSERT_7:= ' INSERT INTO PHA_DTXDBG04_8 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR7||')';
       Q_INSERT_8:= ' INSERT INTO PHA_DTXDBG04_9 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR8||')';
       Q_INSERT_9:= ' INSERT INTO PHA_DTXDBG04_10 (MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM) ('||QUERY_STR9||')';
--DBMS_OUTPUT.ENABLE (buffer_size => NULL);
--      DBMS_OUTPUT.put_line (Q_INSERT_1); 
        EXECUTE IMMEDIATE Q_INSERT;
        EXECUTE IMMEDIATE Q_INSERT_1;
        EXECUTE IMMEDIATE Q_INSERT_2;
        EXECUTE IMMEDIATE Q_INSERT_3;
        EXECUTE IMMEDIATE Q_INSERT_4;
        EXECUTE IMMEDIATE Q_INSERT_5;
        EXECUTE IMMEDIATE Q_INSERT_6;
        EXECUTE IMMEDIATE Q_INSERT_7;
        EXECUTE IMMEDIATE Q_INSERT_8;
        EXECUTE IMMEDIATE Q_INSERT_9;
    QUERY_STR10:= ' SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_1
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_2
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_3
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_4
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_5
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_6
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_7
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_8
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_9
    UNION 
    SELECT MA_CAP,MA_CTMTQG,TEN_CAP,TEN_CTMTQG,MA_CHUONG, MA_NGUON_NSNN, MA_DVQHNS, TEN_DVQHNS, KHVKD, KLHT, KHVNS, KHDTN,KLHTN,VTUCTH, KHVKD_NAM,VTUCTH_NAM FROM PHA_DTXDBG04_10
    ORDER BY MA_CAP
    ';
BEGIN


OPEN cur FOR QUERY_STR10;
EXCEPTION
   WHEN NO_DATA_FOUND
   THEN
      DBMS_OUTPUT.put_line ('<your message>' || SQLERRM);
   WHEN OTHERS
   THEN
    DBMS_OUTPUT.ENABLE (buffer_size => NULL);
      DBMS_OUTPUT.put_line (SQLERRM); 
END;    
END PHA_DTBG_04;