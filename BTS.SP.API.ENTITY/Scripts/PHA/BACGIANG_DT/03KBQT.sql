create or replace PROCEDURE "PHA_DTBG_03_KBQT" (P_CONGTHUC VARCHAR2, TUNGAY_KS IN DATE, DENNGAY_KS IN DATE, TUNGAY_HL IN DATE, DENNGAY_HL IN DATE, DONVI_TIEN number, cur OUT SYS_REFCURSOR) 
AS
   P_CT VARCHAR2(32767);   
   P_SQL_INSERT NVARCHAR2(32767);
   P_SQL_CREATE_TABLE  VARCHAR2(32767);  
   QUERY_STR VARCHAR2(32767);
   QUERY_STR1 VARCHAR2(32767);
   QUERY_STR2 VARCHAR2(32767);
   QUERY_STR3 VARCHAR2(32767);
   QUERY_STR4 VARCHAR2(32767);
   QUERY_STR5 VARCHAR2(32767);
   QUERY_STR6 VARCHAR2(32767);
   QUERY_STR7 VARCHAR2(32767);
   QUERY_STR8 VARCHAR2(32767);
   QUERY_STR9 VARCHAR2(32767);
   QUERY_STR10 VARCHAR2(32767);
   QUERY_STR11 VARCHAR2(32767);
   QUERY_STR12 VARCHAR2(32767);
   QUERY_STR13 VARCHAR2(32767);
   QUERY_STR14 CLOB;
   Q_INSERT CLOB;
   Q_INSERT_1 CLOB;
   Q_INSERT_2 CLOB;
   Q_INSERT_3 CLOB;
   Q_INSERT_4 CLOB;
   Q_INSERT_5 CLOB;
   Q_INSERT_6 CLOB;
   Q_INSERT_7 CLOB;
   Q_INSERT_8 CLOB;
   Q_INSERT_9 CLOB;
   Q_INSERT_10 CLOB;
   Q_INSERT_11 CLOB;
   Q_INSERT_12 CLOB;
   Q_INSERT_13 CLOB;
   N_COUNT NUMBER(18,2):=0;
   NAM_TRUOC VARCHAR2(200); 
   NAM_HIENTAI VARCHAR2(200);
   NAM_SAU VARCHAR2(200);
   BEGIN
        NAM_HIENTAI := TO_CHAR(TUNGAY_HL,'yyyy');
        NAM_TRUOC := REPLACE(TO_CHAR(TO_NUMBER(NAM_HIENTAI, '9999') - 1,'9999'),chr(32),'');
        NAM_SAU := REPLACE(TO_CHAR(TO_NUMBER(NAM_HIENTAI, '9999') + 1,'9999'),chr(32),'');
 P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT1(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT1';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF; 
      P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT2(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT2';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF; 
      P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT3(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT3';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
      P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT4(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT4';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;   
      P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT5(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT5';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF; 
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT6(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT6';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT7(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT7';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT8(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT8';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT9(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT9';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT10(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT10';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT11(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT11';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT12(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT12';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT13(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT13';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
       P_SQL_CREATE_TABLE:='';N_COUNT:= 0;
    P_SQL_CREATE_TABLE := 'CREATE TABLE PHA_DTBG03_KBQT14(MA_NGUON_NSNN  NVARCHAR2(50) , MA_DVQHNS NVARCHAR2(50),TEN_DVQHNS NVARCHAR2(2000), MA_NGANHKT NVARCHAR2(50),TONGSO_LK_NT NUMBER(18,2),VONTUCTH_NT NUMBER(18,2),VONTUCTH_DC NUMBER(18,2),TT_KLHT_NT NUMBER(18,2),
 KHVKD NUMBER(18,2), KLHT NUMBER(18,2),VTUCTH NUMBER(18,2), KHVNS NUMBER(18,2), KHDTN NUMBER(18,2), KLHTN NUMBER(18,2),VTUCTH_NAM NUMBER(18,2), KHVKD_NAM NUMBER(18,2) )SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)';
     BEGIN
          SELECT COUNT(*)  INTO N_COUNT  FROM ALL_TAB_COLUMNS  WHERE TABLE_NAME = 'PHA_DTBG03_KBQT14';
          EXCEPTION WHEN OTHERS THEN N_COUNT:=0;
      END;
      IF(N_COUNT IS NULL OR N_COUNT<=0) THEN
      BEGIN
          EXECUTE IMMEDIATE P_SQL_CREATE_TABLE;  
      END;
      END IF;
QUERY_STR:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT FROM
(SELECT COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD FROM
(SELECT COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT FROM
(SELECT COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT12.TONGSO_LK_NT, COT12.VONTUCTH_NT, COT3.VONTUCTH_DC FROM
(SELECT COT1.MA_CHUONG,COT1.MA_NGUON_NSNN, COT1.MA_DVQHNS, COT1.TEN_DVQHNS, COT1.MA_NGANHKT, COT1.TONGSO_LK_NT, COT2.VONTUCTH_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT1.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT1.MA_DVQHNS = COT2.MA_DVQHNS AND COT1.MA_NGANHKT = COT2.MA_NGANHKT AND COT1.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT1.MA_CHUONG,COT1.MA_NGUON_NSNN, COT1.MA_DVQHNS, COT1.TEN_DVQHNS, COT1.MA_NGANHKT, COT1.TONGSO_LK_NT, COT2.VONTUCTH_NT) COT12
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT12.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT12.MA_DVQHNS = COT3.MA_DVQHNS AND COT12.MA_NGANHKT = COT3.MA_NGANHKT AND COT12.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT12.TONGSO_LK_NT, COT12.VONTUCTH_NT, COT3.VONTUCTH_DC) COT123
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGANHKT = COT4.MA_NGANHKT AND COT123.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT) COT1234
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGANHKT = COT5.MA_NGANHKT AND COT1234.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD) COT12345
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGANHKT = COT6.MA_NGANHKT AND COT12345.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR1:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT FROM
(SELECT COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD FROM
(SELECT COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT FROM
(SELECT COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT12.TONGSO_LK_NT, COT12.VONTUCTH_NT, COT3.VONTUCTH_DC FROM
(SELECT COT2.MA_CHUONG,COT2.MA_NGUON_NSNN, COT2.MA_DVQHNS, COT2.TEN_DVQHNS, COT2.MA_NGANHKT, COT1.TONGSO_LK_NT, COT2.VONTUCTH_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 RIGHT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT1.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT1.MA_DVQHNS = COT2.MA_DVQHNS AND COT1.MA_NGANHKT = COT2.MA_NGANHKT AND COT1.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT2.MA_CHUONG,COT2.MA_NGUON_NSNN, COT2.MA_DVQHNS, COT2.TEN_DVQHNS, COT2.MA_NGANHKT, COT1.TONGSO_LK_NT, COT2.VONTUCTH_NT) COT12
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT12.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT12.MA_DVQHNS = COT3.MA_DVQHNS AND COT12.MA_NGANHKT = COT3.MA_NGANHKT AND COT12.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT12.TONGSO_LK_NT, COT12.VONTUCTH_NT, COT3.VONTUCTH_DC) COT123
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGANHKT = COT4.MA_NGANHKT AND COT123.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT) COT1234
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGANHKT = COT5.MA_NGANHKT AND COT1234.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD) COT12345
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGANHKT = COT6.MA_NGANHKT AND COT12345.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR2:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT FROM
(SELECT COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD FROM
(SELECT COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT FROM
(SELECT COT13.MA_CHUONG,COT13.MA_NGUON_NSNN, COT13.MA_DVQHNS, COT13.TEN_DVQHNS, COT13.MA_NGANHKT, COT13.TONGSO_LK_NT, COT2.VONTUCTH_NT, COT13.VONTUCTH_DC FROM
(SELECT COT3.MA_CHUONG,COT3.MA_NGUON_NSNN, COT3.MA_DVQHNS, COT3.TEN_DVQHNS, COT3.MA_NGANHKT, COT1.TONGSO_LK_NT, COT3.VONTUCTH_DC FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT3.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT3.MA_DVQHNS = COT1.MA_DVQHNS AND COT3.MA_NGANHKT = COT1.MA_NGANHKT AND COT3.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT3.MA_CHUONG,COT3.MA_NGUON_NSNN, COT3.MA_DVQHNS, COT3.TEN_DVQHNS, COT3.MA_NGANHKT, COT1.TONGSO_LK_NT, COT3.VONTUCTH_DC) COT13
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT13.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT13.MA_DVQHNS = COT2.MA_DVQHNS AND COT13.MA_NGANHKT = COT2.MA_NGANHKT AND COT13.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT13.MA_CHUONG,COT13.MA_NGUON_NSNN, COT13.MA_DVQHNS, COT13.TEN_DVQHNS, COT13.MA_NGANHKT, COT13.TONGSO_LK_NT, COT2.VONTUCTH_NT, COT13.VONTUCTH_DC) COT123
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT123.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT123.MA_DVQHNS = COT4.MA_DVQHNS AND COT123.MA_NGANHKT = COT4.MA_NGANHKT AND COT123.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT123.MA_CHUONG,COT123.MA_NGUON_NSNN, COT123.MA_DVQHNS, COT123.TEN_DVQHNS, COT123.MA_NGANHKT, COT123.TONGSO_LK_NT, COT123.VONTUCTH_NT, COT123.VONTUCTH_DC, COT4.TT_KLHT_NT) COT1234
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGANHKT = COT5.MA_NGANHKT AND COT1234.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD) COT12345
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGANHKT = COT6.MA_NGANHKT AND COT12345.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR3:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT FROM
(SELECT COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD FROM
(SELECT COT124.MA_CHUONG,COT124.MA_NGUON_NSNN, COT124.MA_DVQHNS, COT124.TEN_DVQHNS, COT124.MA_NGANHKT, COT124.TONGSO_LK_NT, COT124.VONTUCTH_NT, COT3.VONTUCTH_DC,COT124.TT_KLHT_NT FROM
(SELECT COT14.MA_CHUONG,COT14.MA_NGUON_NSNN, COT14.MA_DVQHNS, COT14.TEN_DVQHNS, COT14.MA_NGANHKT, COT14.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT14.TT_KLHT_NT FROM
(SELECT COT4.MA_CHUONG,COT4.MA_NGUON_NSNN, COT4.MA_DVQHNS, COT4.TEN_DVQHNS, COT4.MA_NGANHKT, COT1.TONGSO_LK_NT, COT4.TT_KLHT_NT FROM
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT4.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT4.MA_DVQHNS = COT1.MA_DVQHNS AND COT4.MA_NGANHKT = COT1.MA_NGANHKT AND COT4.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT4.MA_CHUONG,COT4.MA_NGUON_NSNN, COT4.MA_DVQHNS, COT4.TEN_DVQHNS, COT4.MA_NGANHKT, COT1.TONGSO_LK_NT, COT4.TT_KLHT_NT) COT14
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT14.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT14.MA_DVQHNS = COT2.MA_DVQHNS AND COT14.MA_NGANHKT = COT2.MA_NGANHKT AND COT14.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT14.MA_CHUONG,COT14.MA_NGUON_NSNN, COT14.MA_DVQHNS, COT14.TEN_DVQHNS, COT14.MA_NGANHKT, COT14.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT14.TT_KLHT_NT) COT124
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT124.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT124.MA_DVQHNS = COT3.MA_DVQHNS AND COT124.MA_NGANHKT = COT3.MA_NGANHKT AND COT124.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT124.MA_CHUONG,COT124.MA_NGUON_NSNN, COT124.MA_DVQHNS, COT124.TEN_DVQHNS, COT124.MA_NGANHKT, COT124.TONGSO_LK_NT, COT124.VONTUCTH_NT, COT3.VONTUCTH_DC,COT124.TT_KLHT_NT) COT1234
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT1234.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT1234.MA_DVQHNS = COT5.MA_DVQHNS AND COT1234.MA_NGANHKT = COT5.MA_NGANHKT AND COT1234.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT1234.MA_CHUONG,COT1234.MA_NGUON_NSNN, COT1234.MA_DVQHNS, COT1234.TEN_DVQHNS, COT1234.MA_NGANHKT, COT1234.TONGSO_LK_NT, COT1234.VONTUCTH_NT, COT1234.VONTUCTH_DC, COT1234.TT_KLHT_NT, COT5.KHVKD) COT12345
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGANHKT = COT6.MA_NGANHKT AND COT12345.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR4:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT FROM
(SELECT COT1235.MA_CHUONG,COT1235.MA_NGUON_NSNN, COT1235.MA_DVQHNS, COT1235.TEN_DVQHNS, COT1235.MA_NGANHKT, COT1235.TONGSO_LK_NT, COT1235.VONTUCTH_NT, COT1235.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1235.KHVKD FROM
(SELECT COT125.MA_CHUONG,COT125.MA_NGUON_NSNN, COT125.MA_DVQHNS, COT125.TEN_DVQHNS, COT125.MA_NGANHKT, COT125.TONGSO_LK_NT, COT125.VONTUCTH_NT, COT3.VONTUCTH_DC,COT125.KHVKD FROM
(SELECT COT15.MA_CHUONG,COT15.MA_NGUON_NSNN, COT15.MA_DVQHNS, COT15.TEN_DVQHNS, COT15.MA_NGANHKT, COT15.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT15.KHVKD FROM
(SELECT COT5.MA_CHUONG,COT5.MA_NGUON_NSNN, COT5.MA_DVQHNS, COT5.TEN_DVQHNS, COT5.MA_NGANHKT, COT1.TONGSO_LK_NT, COT5.KHVKD FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT5.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT5.MA_DVQHNS = COT1.MA_DVQHNS AND COT5.MA_NGANHKT = COT1.MA_NGANHKT AND COT5.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT5.MA_CHUONG,COT5.MA_NGUON_NSNN, COT5.MA_DVQHNS, COT5.TEN_DVQHNS, COT5.MA_NGANHKT, COT1.TONGSO_LK_NT, COT5.KHVKD) COT15
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT15.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT15.MA_DVQHNS = COT2.MA_DVQHNS AND COT15.MA_NGANHKT = COT2.MA_NGANHKT AND COT15.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT15.MA_CHUONG,COT15.MA_NGUON_NSNN, COT15.MA_DVQHNS, COT15.TEN_DVQHNS, COT15.MA_NGANHKT, COT15.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT15.KHVKD) COT125
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT125.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT125.MA_DVQHNS = COT3.MA_DVQHNS AND COT125.MA_NGANHKT = COT3.MA_NGANHKT AND COT125.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT125.MA_CHUONG,COT125.MA_NGUON_NSNN, COT125.MA_DVQHNS, COT125.TEN_DVQHNS, COT125.MA_NGANHKT, COT125.TONGSO_LK_NT, COT125.VONTUCTH_NT, COT3.VONTUCTH_DC,COT125.KHVKD) COT1235
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT1235.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1235.MA_DVQHNS = COT4.MA_DVQHNS AND COT1235.MA_NGANHKT = COT4.MA_NGANHKT AND COT1235.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT1235.MA_CHUONG,COT1235.MA_NGUON_NSNN, COT1235.MA_DVQHNS, COT1235.TEN_DVQHNS, COT1235.MA_NGANHKT, COT1235.TONGSO_LK_NT, COT1235.VONTUCTH_NT, COT1235.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1235.KHVKD) COT12345
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT12345.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT12345.MA_DVQHNS = COT6.MA_DVQHNS AND COT12345.MA_NGANHKT = COT6.MA_NGANHKT AND COT12345.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT12345.MA_CHUONG,COT12345.MA_NGUON_NSNN, COT12345.MA_DVQHNS, COT12345.TEN_DVQHNS, COT12345.MA_NGANHKT, COT12345.TONGSO_LK_NT, COT12345.VONTUCTH_NT, COT12345.VONTUCTH_DC, COT12345.TT_KLHT_NT, COT12345.KHVKD,COT6.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR5:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG FROM
(SELECT COT12346.MA_CHUONG,COT12346.MA_NGUON_NSNN, COT12346.MA_DVQHNS, COT12346.TEN_DVQHNS, COT12346.MA_NGANHKT, COT12346.TONGSO_LK_NT, COT12346.VONTUCTH_NT, COT12346.VONTUCTH_DC, COT12346.TT_KLHT_NT, COT5.KHVKD,COT12346.KLHT FROM
(SELECT COT1236.MA_CHUONG,COT1236.MA_NGUON_NSNN, COT1236.MA_DVQHNS, COT1236.TEN_DVQHNS, COT1236.MA_NGANHKT, COT1236.TONGSO_LK_NT, COT1236.VONTUCTH_NT, COT1236.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1236.KLHT FROM
(SELECT COT126.MA_CHUONG,COT126.MA_NGUON_NSNN, COT126.MA_DVQHNS, COT126.TEN_DVQHNS, COT126.MA_NGANHKT, COT126.TONGSO_LK_NT, COT126.VONTUCTH_NT, COT3.VONTUCTH_DC,COT126.KLHT FROM
(SELECT COT16.MA_CHUONG,COT16.MA_NGUON_NSNN, COT16.MA_DVQHNS, COT16.TEN_DVQHNS, COT16.MA_NGANHKT, COT16.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT16.KLHT FROM
(SELECT COT6.MA_CHUONG,COT6.MA_NGUON_NSNN, COT6.MA_DVQHNS, COT6.TEN_DVQHNS, COT6.MA_NGANHKT, COT1.TONGSO_LK_NT, COT6.KLHT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT6.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT6.MA_DVQHNS = COT1.MA_DVQHNS AND COT6.MA_NGANHKT = COT1.MA_NGANHKT AND COT6.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT6.MA_CHUONG,COT6.MA_NGUON_NSNN, COT6.MA_DVQHNS, COT6.TEN_DVQHNS, COT6.MA_NGANHKT, COT1.TONGSO_LK_NT, COT6.KLHT) COT16
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT16.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT16.MA_DVQHNS = COT2.MA_DVQHNS AND COT16.MA_NGANHKT = COT2.MA_NGANHKT AND COT16.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT16.MA_CHUONG,COT16.MA_NGUON_NSNN, COT16.MA_DVQHNS, COT16.TEN_DVQHNS, COT16.MA_NGANHKT, COT16.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT16.KLHT) COT126
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT126.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT126.MA_DVQHNS = COT3.MA_DVQHNS AND COT126.MA_NGANHKT = COT3.MA_NGANHKT AND COT126.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT126.MA_CHUONG,COT126.MA_NGUON_NSNN, COT126.MA_DVQHNS, COT126.TEN_DVQHNS, COT126.MA_NGANHKT, COT126.TONGSO_LK_NT, COT126.VONTUCTH_NT, COT3.VONTUCTH_DC,COT126.KLHT) COT1236
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT1236.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1236.MA_DVQHNS = COT4.MA_DVQHNS AND COT1236.MA_NGANHKT = COT4.MA_NGANHKT AND COT1236.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT1236.MA_CHUONG,COT1236.MA_NGUON_NSNN, COT1236.MA_DVQHNS, COT1236.TEN_DVQHNS, COT1236.MA_NGANHKT, COT1236.TONGSO_LK_NT, COT1236.VONTUCTH_NT, COT1236.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1236.KLHT) COT12346
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT12346.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12346.MA_DVQHNS = COT5.MA_DVQHNS AND COT12346.MA_NGANHKT = COT5.MA_NGANHKT AND COT12346.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT12346.MA_CHUONG,COT12346.MA_NGUON_NSNN, COT12346.MA_DVQHNS, COT12346.TEN_DVQHNS, COT12346.MA_NGANHKT, COT12346.TONGSO_LK_NT, COT12346.VONTUCTH_NT, COT12346.VONTUCTH_DC, COT12346.TT_KLHT_NT, COT5.KHVKD,COT12346.KLHT) COT123456
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT123456.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT123456.MA_DVQHNS = COT7.MA_DVQHNS AND COT123456.MA_NGANHKT = COT7.MA_NGANHKT AND COT123456.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT123456.MA_CHUONG,COT123456.MA_NGUON_NSNN, COT123456.MA_DVQHNS, COT123456.TEN_DVQHNS, COT123456.MA_NGANHKT, COT123456.TONGSO_LK_NT, COT123456.VONTUCTH_NT, COT123456.VONTUCTH_DC, COT123456.TT_KLHT_NT, COT123456.KHVKD,COT123456.KLHT,COT7.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR6:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH FROM
(SELECT COT123457.MA_CHUONG,COT123457.MA_NGUON_NSNN, COT123457.MA_DVQHNS, COT123457.TEN_DVQHNS, COT123457.MA_NGANHKT, COT123457.TONGSO_LK_NT, COT123457.VONTUCTH_NT, COT123457.VONTUCTH_DC, COT123457.TT_KLHT_NT, COT123457.KHVKD,COT6.KLHT,COT123457.HOANUNG FROM
(SELECT COT12347.MA_CHUONG,COT12347.MA_NGUON_NSNN, COT12347.MA_DVQHNS, COT12347.TEN_DVQHNS, COT12347.MA_NGANHKT, COT12347.TONGSO_LK_NT, COT12347.VONTUCTH_NT, COT12347.VONTUCTH_DC, COT12347.TT_KLHT_NT, COT5.KHVKD,COT12347.HOANUNG FROM
(SELECT COT1237.MA_CHUONG,COT1237.MA_NGUON_NSNN, COT1237.MA_DVQHNS, COT1237.TEN_DVQHNS, COT1237.MA_NGANHKT, COT1237.TONGSO_LK_NT, COT1237.VONTUCTH_NT, COT1237.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1237.HOANUNG FROM
(SELECT COT127.MA_CHUONG,COT127.MA_NGUON_NSNN, COT127.MA_DVQHNS, COT127.TEN_DVQHNS, COT127.MA_NGANHKT, COT127.TONGSO_LK_NT, COT127.VONTUCTH_NT, COT3.VONTUCTH_DC,COT127.HOANUNG FROM
(SELECT COT17.MA_CHUONG,COT17.MA_NGUON_NSNN, COT17.MA_DVQHNS, COT17.TEN_DVQHNS, COT17.MA_NGANHKT, COT17.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT17.HOANUNG FROM
(SELECT COT7.MA_CHUONG,COT7.MA_NGUON_NSNN, COT7.MA_DVQHNS, COT7.TEN_DVQHNS, COT7.MA_NGANHKT, COT1.TONGSO_LK_NT, COT7.HOANUNG FROM
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT7.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT7.MA_DVQHNS = COT1.MA_DVQHNS AND COT7.MA_NGANHKT = COT1.MA_NGANHKT AND COT7.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT7.MA_CHUONG,COT7.MA_NGUON_NSNN, COT7.MA_DVQHNS, COT7.TEN_DVQHNS, COT7.MA_NGANHKT, COT1.TONGSO_LK_NT, COT7.HOANUNG) COT17
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT17.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT17.MA_DVQHNS = COT2.MA_DVQHNS AND COT17.MA_NGANHKT = COT2.MA_NGANHKT AND COT17.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT17.MA_CHUONG,COT17.MA_NGUON_NSNN, COT17.MA_DVQHNS, COT17.TEN_DVQHNS, COT17.MA_NGANHKT, COT17.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT17.HOANUNG) COT127
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT127.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT127.MA_DVQHNS = COT3.MA_DVQHNS AND COT127.MA_NGANHKT = COT3.MA_NGANHKT AND COT127.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT127.MA_CHUONG,COT127.MA_NGUON_NSNN, COT127.MA_DVQHNS, COT127.TEN_DVQHNS, COT127.MA_NGANHKT, COT127.TONGSO_LK_NT, COT127.VONTUCTH_NT, COT3.VONTUCTH_DC,COT127.HOANUNG) COT1237
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT1237.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1237.MA_DVQHNS = COT4.MA_DVQHNS AND COT1237.MA_NGANHKT = COT4.MA_NGANHKT AND COT1237.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT1237.MA_CHUONG,COT1237.MA_NGUON_NSNN, COT1237.MA_DVQHNS, COT1237.TEN_DVQHNS, COT1237.MA_NGANHKT, COT1237.TONGSO_LK_NT, COT1237.VONTUCTH_NT, COT1237.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1237.HOANUNG) COT12347
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT12347.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12347.MA_DVQHNS = COT5.MA_DVQHNS AND COT12347.MA_NGANHKT = COT5.MA_NGANHKT AND COT12347.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT12347.MA_CHUONG,COT12347.MA_NGUON_NSNN, COT12347.MA_DVQHNS, COT12347.TEN_DVQHNS, COT12347.MA_NGANHKT, COT12347.TONGSO_LK_NT, COT12347.VONTUCTH_NT, COT12347.VONTUCTH_DC, COT12347.TT_KLHT_NT, COT5.KHVKD,COT12347.HOANUNG) COT123457
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT123457.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123457.MA_DVQHNS = COT6.MA_DVQHNS AND COT123457.MA_NGANHKT = COT6.MA_NGANHKT AND COT123457.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT123457.MA_CHUONG,COT123457.MA_NGUON_NSNN, COT123457.MA_DVQHNS, COT123457.TEN_DVQHNS, COT123457.MA_NGANHKT, COT123457.TONGSO_LK_NT, COT123457.VONTUCTH_NT, COT123457.VONTUCTH_DC, COT123457.TT_KLHT_NT, COT123457.KHVKD,COT6.KLHT,COT123457.HOANUNG) COT1234567
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT1234567.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT1234567.MA_DVQHNS = COT8.MA_DVQHNS AND COT1234567.MA_NGANHKT = COT8.MA_NGANHKT AND COT1234567.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT1234567.MA_CHUONG,COT1234567.MA_NGUON_NSNN, COT1234567.MA_DVQHNS, COT1234567.TEN_DVQHNS, COT1234567.MA_NGANHKT, COT1234567.TONGSO_LK_NT, COT1234567.VONTUCTH_NT, COT1234567.VONTUCTH_DC, COT1234567.TT_KLHT_NT, COT1234567.KHVKD,COT1234567.KLHT,COT1234567.HOANUNG, COT8.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR7:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS FROM
(SELECT COT1234568.MA_CHUONG,COT1234568.MA_NGUON_NSNN, COT1234568.MA_DVQHNS, COT1234568.TEN_DVQHNS, COT1234568.MA_NGANHKT, COT1234568.TONGSO_LK_NT, COT1234568.VONTUCTH_NT, COT1234568.VONTUCTH_DC, COT1234568.TT_KLHT_NT, COT1234568.KHVKD,COT1234568.KLHT,COT7.HOANUNG,COT1234568.VTUCTH FROM
(SELECT COT123458.MA_CHUONG,COT123458.MA_NGUON_NSNN, COT123458.MA_DVQHNS, COT123458.TEN_DVQHNS, COT123458.MA_NGANHKT, COT123458.TONGSO_LK_NT, COT123458.VONTUCTH_NT, COT123458.VONTUCTH_DC, COT123458.TT_KLHT_NT, COT123458.KHVKD,COT6.KLHT,COT123458.VTUCTH FROM
(SELECT COT12348.MA_CHUONG,COT12348.MA_NGUON_NSNN, COT12348.MA_DVQHNS, COT12348.TEN_DVQHNS, COT12348.MA_NGANHKT, COT12348.TONGSO_LK_NT, COT12348.VONTUCTH_NT, COT12348.VONTUCTH_DC, COT12348.TT_KLHT_NT, COT5.KHVKD,COT12348.VTUCTH FROM
(SELECT COT1238.MA_CHUONG,COT1238.MA_NGUON_NSNN, COT1238.MA_DVQHNS, COT1238.TEN_DVQHNS, COT1238.MA_NGANHKT, COT1238.TONGSO_LK_NT, COT1238.VONTUCTH_NT, COT1238.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1238.VTUCTH FROM
(SELECT COT128.MA_CHUONG,COT128.MA_NGUON_NSNN, COT128.MA_DVQHNS, COT128.TEN_DVQHNS, COT128.MA_NGANHKT, COT128.TONGSO_LK_NT, COT128.VONTUCTH_NT, COT3.VONTUCTH_DC,COT128.VTUCTH FROM
(SELECT COT18.MA_CHUONG,COT18.MA_NGUON_NSNN, COT18.MA_DVQHNS, COT18.TEN_DVQHNS, COT18.MA_NGANHKT, COT18.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT18.VTUCTH FROM
(SELECT COT8.MA_CHUONG,COT8.MA_NGUON_NSNN, COT8.MA_DVQHNS, COT8.TEN_DVQHNS, COT8.MA_NGANHKT, COT1.TONGSO_LK_NT, COT8.VTUCTH FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT8.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT8.MA_DVQHNS = COT1.MA_DVQHNS AND COT8.MA_NGANHKT = COT1.MA_NGANHKT AND COT8.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT8.MA_CHUONG,COT8.MA_NGUON_NSNN, COT8.MA_DVQHNS, COT8.TEN_DVQHNS, COT8.MA_NGANHKT, COT1.TONGSO_LK_NT, COT8.VTUCTH)COT18
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT18.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT18.MA_DVQHNS = COT2.MA_DVQHNS AND COT18.MA_NGANHKT = COT2.MA_NGANHKT AND COT18.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT18.MA_CHUONG,COT18.MA_NGUON_NSNN, COT18.MA_DVQHNS, COT18.TEN_DVQHNS, COT18.MA_NGANHKT, COT18.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT18.VTUCTH) COT128
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT128.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT128.MA_DVQHNS = COT3.MA_DVQHNS AND COT128.MA_NGANHKT = COT3.MA_NGANHKT AND COT128.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT128.MA_CHUONG,COT128.MA_NGUON_NSNN, COT128.MA_DVQHNS, COT128.TEN_DVQHNS, COT128.MA_NGANHKT, COT128.TONGSO_LK_NT, COT128.VONTUCTH_NT, COT3.VONTUCTH_DC,COT128.VTUCTH) COT1238
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT1238.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1238.MA_DVQHNS = COT4.MA_DVQHNS AND COT1238.MA_NGANHKT = COT4.MA_NGANHKT AND COT1238.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT1238.MA_CHUONG,COT1238.MA_NGUON_NSNN, COT1238.MA_DVQHNS, COT1238.TEN_DVQHNS, COT1238.MA_NGANHKT, COT1238.TONGSO_LK_NT, COT1238.VONTUCTH_NT, COT1238.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1238.VTUCTH) COT12348
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT12348.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12348.MA_DVQHNS = COT5.MA_DVQHNS AND COT12348.MA_NGANHKT = COT5.MA_NGANHKT AND COT12348.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT12348.MA_CHUONG,COT12348.MA_NGUON_NSNN, COT12348.MA_DVQHNS, COT12348.TEN_DVQHNS, COT12348.MA_NGANHKT, COT12348.TONGSO_LK_NT, COT12348.VONTUCTH_NT, COT12348.VONTUCTH_DC, COT12348.TT_KLHT_NT, COT5.KHVKD,COT12348.VTUCTH) COT123458
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT123458.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123458.MA_DVQHNS = COT6.MA_DVQHNS AND COT123458.MA_NGANHKT = COT6.MA_NGANHKT AND COT123458.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT123458.MA_CHUONG,COT123458.MA_NGUON_NSNN, COT123458.MA_DVQHNS, COT123458.TEN_DVQHNS, COT123458.MA_NGANHKT, COT123458.TONGSO_LK_NT, COT123458.VONTUCTH_NT, COT123458.VONTUCTH_DC, COT123458.TT_KLHT_NT, COT123458.KHVKD,COT6.KLHT,COT123458.VTUCTH) COT1234568
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT1234568.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT1234568.MA_DVQHNS = COT7.MA_DVQHNS AND COT1234568.MA_NGANHKT = COT7.MA_NGANHKT AND COT1234568.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT1234568.MA_CHUONG,COT1234568.MA_NGUON_NSNN, COT1234568.MA_DVQHNS, COT1234568.TEN_DVQHNS, COT1234568.MA_NGANHKT, COT1234568.TONGSO_LK_NT, COT1234568.VONTUCTH_NT, COT1234568.VONTUCTH_DC, COT1234568.TT_KLHT_NT, COT1234568.KHVKD,COT1234568.KLHT,COT7.HOANUNG,COT1234568.VTUCTH) COT12345678
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT12345678.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT12345678.MA_DVQHNS = COT9.MA_DVQHNS AND COT12345678.MA_NGANHKT = COT9.MA_NGANHKT AND COT12345678.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT12345678.MA_CHUONG,COT12345678.MA_NGUON_NSNN, COT12345678.MA_DVQHNS, COT12345678.TEN_DVQHNS, COT12345678.MA_NGANHKT, COT12345678.TONGSO_LK_NT, COT12345678.VONTUCTH_NT, COT12345678.VONTUCTH_DC, COT12345678.TT_KLHT_NT, COT12345678.KHVKD,COT12345678.KLHT,COT12345678.HOANUNG, COT12345678.VTUCTH, COT9.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR8:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN FROM
(SELECT COT12345679.MA_CHUONG,COT12345679.MA_NGUON_NSNN, COT12345679.MA_DVQHNS, COT12345679.TEN_DVQHNS, COT12345679.MA_NGANHKT, COT12345679.TONGSO_LK_NT, COT12345679.VONTUCTH_NT, COT12345679.VONTUCTH_DC, COT12345679.TT_KLHT_NT, COT12345679.KHVKD,COT12345679.KLHT,COT12345679.HOANUNG, COT8.VTUCTH,COT12345679.KHVNS FROM
(SELECT COT1234569.MA_CHUONG,COT1234569.MA_NGUON_NSNN, COT1234569.MA_DVQHNS, COT1234569.TEN_DVQHNS, COT1234569.MA_NGANHKT, COT1234569.TONGSO_LK_NT, COT1234569.VONTUCTH_NT, COT1234569.VONTUCTH_DC, COT1234569.TT_KLHT_NT, COT1234569.KHVKD,COT1234569.KLHT,COT7.HOANUNG,COT1234569.KHVNS FROM
(SELECT COT123459.MA_CHUONG,COT123459.MA_NGUON_NSNN, COT123459.MA_DVQHNS, COT123459.TEN_DVQHNS, COT123459.MA_NGANHKT, COT123459.TONGSO_LK_NT, COT123459.VONTUCTH_NT, COT123459.VONTUCTH_DC, COT123459.TT_KLHT_NT, COT123459.KHVKD,COT6.KLHT,COT123459.KHVNS FROM
(SELECT COT12349.MA_CHUONG,COT12349.MA_NGUON_NSNN, COT12349.MA_DVQHNS, COT12349.TEN_DVQHNS, COT12349.MA_NGANHKT, COT12349.TONGSO_LK_NT, COT12349.VONTUCTH_NT, COT12349.VONTUCTH_DC, COT12349.TT_KLHT_NT, COT5.KHVKD,COT12349.KHVNS FROM
(SELECT COT1239.MA_CHUONG,COT1239.MA_NGUON_NSNN, COT1239.MA_DVQHNS, COT1239.TEN_DVQHNS, COT1239.MA_NGANHKT, COT1239.TONGSO_LK_NT, COT1239.VONTUCTH_NT, COT1239.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1239.KHVNS FROM
(SELECT COT129.MA_CHUONG,COT129.MA_NGUON_NSNN, COT129.MA_DVQHNS, COT129.TEN_DVQHNS, COT129.MA_NGANHKT, COT129.TONGSO_LK_NT, COT129.VONTUCTH_NT, COT3.VONTUCTH_DC,COT129.KHVNS FROM
(SELECT COT19.MA_CHUONG,COT19.MA_NGUON_NSNN, COT19.MA_DVQHNS, COT19.TEN_DVQHNS, COT19.MA_NGANHKT, COT19.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT19.KHVNS FROM
(SELECT COT9.MA_CHUONG,COT9.MA_NGUON_NSNN, COT9.MA_DVQHNS, COT9.TEN_DVQHNS, COT9.MA_NGANHKT, COT1.TONGSO_LK_NT, COT9.KHVNS FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT9.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT9.MA_DVQHNS = COT1.MA_DVQHNS AND COT9.MA_NGANHKT = COT1.MA_NGANHKT AND COT9.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT9.MA_CHUONG,COT9.MA_NGUON_NSNN, COT9.MA_DVQHNS, COT9.TEN_DVQHNS, COT9.MA_NGANHKT, COT1.TONGSO_LK_NT, COT9.KHVNS) COT19
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT19.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT19.MA_DVQHNS = COT2.MA_DVQHNS AND COT19.MA_NGANHKT = COT2.MA_NGANHKT AND COT19.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT19.MA_CHUONG,COT19.MA_NGUON_NSNN, COT19.MA_DVQHNS, COT19.TEN_DVQHNS, COT19.MA_NGANHKT, COT19.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT19.KHVNS) COT129
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT129.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT129.MA_DVQHNS = COT3.MA_DVQHNS AND COT129.MA_NGANHKT = COT3.MA_NGANHKT AND COT129.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT129.MA_CHUONG,COT129.MA_NGUON_NSNN, COT129.MA_DVQHNS, COT129.TEN_DVQHNS, COT129.MA_NGANHKT, COT129.TONGSO_LK_NT, COT129.VONTUCTH_NT, COT3.VONTUCTH_DC,COT129.KHVNS) COT1239
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT1239.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT1239.MA_DVQHNS = COT4.MA_DVQHNS AND COT1239.MA_NGANHKT = COT4.MA_NGANHKT AND COT1239.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT1239.MA_CHUONG,COT1239.MA_NGUON_NSNN, COT1239.MA_DVQHNS, COT1239.TEN_DVQHNS, COT1239.MA_NGANHKT, COT1239.TONGSO_LK_NT, COT1239.VONTUCTH_NT, COT1239.VONTUCTH_DC, COT4.TT_KLHT_NT,COT1239.KHVNS) COT12349
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT12349.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT12349.MA_DVQHNS = COT5.MA_DVQHNS AND COT12349.MA_NGANHKT = COT5.MA_NGANHKT AND COT12349.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT12349.MA_CHUONG,COT12349.MA_NGUON_NSNN, COT12349.MA_DVQHNS, COT12349.TEN_DVQHNS, COT12349.MA_NGANHKT, COT12349.TONGSO_LK_NT, COT12349.VONTUCTH_NT, COT12349.VONTUCTH_DC, COT12349.TT_KLHT_NT, COT5.KHVKD,COT12349.KHVNS) COT123459
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT123459.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT123459.MA_DVQHNS = COT6.MA_DVQHNS AND COT123459.MA_NGANHKT = COT6.MA_NGANHKT AND COT123459.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT123459.MA_CHUONG,COT123459.MA_NGUON_NSNN, COT123459.MA_DVQHNS, COT123459.TEN_DVQHNS, COT123459.MA_NGANHKT, COT123459.TONGSO_LK_NT, COT123459.VONTUCTH_NT, COT123459.VONTUCTH_DC, COT123459.TT_KLHT_NT, COT123459.KHVKD,COT6.KLHT,COT123459.KHVNS) COT1234569
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT1234569.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT1234569.MA_DVQHNS = COT7.MA_DVQHNS AND COT1234569.MA_NGANHKT = COT7.MA_NGANHKT AND COT1234569.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT1234569.MA_CHUONG,COT1234569.MA_NGUON_NSNN, COT1234569.MA_DVQHNS, COT1234569.TEN_DVQHNS, COT1234569.MA_NGANHKT, COT1234569.TONGSO_LK_NT, COT1234569.VONTUCTH_NT, COT1234569.VONTUCTH_DC, COT1234569.TT_KLHT_NT, COT1234569.KHVKD,COT1234569.KLHT,COT7.HOANUNG,COT1234569.KHVNS) COT12345679
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT12345679.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT12345679.MA_DVQHNS = COT8.MA_DVQHNS AND COT12345679.MA_NGANHKT = COT8.MA_NGANHKT AND COT12345679.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT12345679.MA_CHUONG,COT12345679.MA_NGUON_NSNN, COT12345679.MA_DVQHNS, COT12345679.TEN_DVQHNS, COT12345679.MA_NGANHKT, COT12345679.TONGSO_LK_NT, COT12345679.VONTUCTH_NT, COT12345679.VONTUCTH_DC, COT12345679.TT_KLHT_NT, COT12345679.KHVKD,COT12345679.KLHT,COT12345679.HOANUNG, COT8.VTUCTH,COT12345679.KHVNS) COT123456789
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT123456789.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT123456789.MA_DVQHNS = COT10.MA_DVQHNS AND COT123456789.MA_NGANHKT = COT10.MA_NGANHKT AND COT123456789.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT123456789.MA_CHUONG,COT123456789.MA_NGUON_NSNN, COT123456789.MA_DVQHNS, COT123456789.TEN_DVQHNS, COT123456789.MA_NGANHKT, COT123456789.TONGSO_LK_NT, COT123456789.VONTUCTH_NT, COT123456789.VONTUCTH_DC, COT123456789.TT_KLHT_NT, COT123456789.KHVKD,COT123456789.KLHT,COT123456789.HOANUNG, COT123456789.VTUCTH, COT123456789.KHVNS, COT10.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR9:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN FROM
(SELECT COT1234567810.MA_CHUONG,COT1234567810.MA_NGUON_NSNN, COT1234567810.MA_DVQHNS, COT1234567810.TEN_DVQHNS, COT1234567810.MA_NGANHKT, COT1234567810.TONGSO_LK_NT, COT1234567810.VONTUCTH_NT, COT1234567810.VONTUCTH_DC, COT1234567810.TT_KLHT_NT, COT1234567810.KHVKD,COT1234567810.KLHT,COT1234567810.HOANUNG, COT1234567810.VTUCTH, COT9.KHVNS,COT1234567810.KHDTN FROM
(SELECT COT123456710.MA_CHUONG,COT123456710.MA_NGUON_NSNN, COT123456710.MA_DVQHNS, COT123456710.TEN_DVQHNS, COT123456710.MA_NGANHKT, COT123456710.TONGSO_LK_NT, COT123456710.VONTUCTH_NT, COT123456710.VONTUCTH_DC, COT123456710.TT_KLHT_NT, COT123456710.KHVKD,COT123456710.KLHT,COT123456710.HOANUNG, COT8.VTUCTH,COT123456710.KHDTN FROM
(SELECT COT12345610.MA_CHUONG,COT12345610.MA_NGUON_NSNN, COT12345610.MA_DVQHNS, COT12345610.TEN_DVQHNS, COT12345610.MA_NGANHKT, COT12345610.TONGSO_LK_NT, COT12345610.VONTUCTH_NT, COT12345610.VONTUCTH_DC, COT12345610.TT_KLHT_NT, COT12345610.KHVKD,COT12345610.KLHT,COT7.HOANUNG,COT12345610.KHDTN FROM
(SELECT COT1234510.MA_CHUONG,COT1234510.MA_NGUON_NSNN, COT1234510.MA_DVQHNS, COT1234510.TEN_DVQHNS, COT1234510.MA_NGANHKT, COT1234510.TONGSO_LK_NT, COT1234510.VONTUCTH_NT, COT1234510.VONTUCTH_DC, COT1234510.TT_KLHT_NT, COT1234510.KHVKD,COT6.KLHT,COT1234510.KHDTN FROM
(SELECT COT123410.MA_CHUONG,COT123410.MA_NGUON_NSNN, COT123410.MA_DVQHNS, COT123410.TEN_DVQHNS, COT123410.MA_NGANHKT, COT123410.TONGSO_LK_NT, COT123410.VONTUCTH_NT, COT123410.VONTUCTH_DC, COT123410.TT_KLHT_NT, COT5.KHVKD,COT123410.KHDTN FROM
(SELECT COT12310.MA_CHUONG,COT12310.MA_NGUON_NSNN, COT12310.MA_DVQHNS, COT12310.TEN_DVQHNS, COT12310.MA_NGANHKT, COT12310.TONGSO_LK_NT, COT12310.VONTUCTH_NT, COT12310.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12310.KHDTN FROM
(SELECT COT1210.MA_CHUONG,COT1210.MA_NGUON_NSNN, COT1210.MA_DVQHNS, COT1210.TEN_DVQHNS, COT1210.MA_NGANHKT, COT1210.TONGSO_LK_NT, COT1210.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1210.KHDTN FROM
(SELECT COT110.MA_CHUONG,COT110.MA_NGUON_NSNN, COT110.MA_DVQHNS, COT110.TEN_DVQHNS, COT110.MA_NGANHKT, COT110.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT110.KHDTN FROM
(SELECT COT10.MA_CHUONG,COT10.MA_NGUON_NSNN, COT10.MA_DVQHNS, COT10.TEN_DVQHNS, COT10.MA_NGANHKT, COT1.TONGSO_LK_NT, COT10.KHDTN FROM
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT10.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT10.MA_DVQHNS = COT1.MA_DVQHNS AND COT10.MA_NGANHKT = COT1.MA_NGANHKT AND COT10.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT10.MA_CHUONG,COT10.MA_NGUON_NSNN, COT10.MA_DVQHNS, COT10.TEN_DVQHNS, COT10.MA_NGANHKT, COT1.TONGSO_LK_NT, COT10.KHDTN) COT110
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT110.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT110.MA_DVQHNS = COT2.MA_DVQHNS AND COT110.MA_NGANHKT = COT2.MA_NGANHKT AND COT110.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT110.MA_CHUONG,COT110.MA_NGUON_NSNN, COT110.MA_DVQHNS, COT110.TEN_DVQHNS, COT110.MA_NGANHKT, COT110.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT110.KHDTN) COT1210
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT1210.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1210.MA_DVQHNS = COT3.MA_DVQHNS AND COT1210.MA_NGANHKT = COT3.MA_NGANHKT AND COT1210.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT1210.MA_CHUONG,COT1210.MA_NGUON_NSNN, COT1210.MA_DVQHNS, COT1210.TEN_DVQHNS, COT1210.MA_NGANHKT, COT1210.TONGSO_LK_NT, COT1210.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1210.KHDTN) COT12310
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT12310.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12310.MA_DVQHNS = COT4.MA_DVQHNS AND COT12310.MA_NGANHKT = COT4.MA_NGANHKT AND COT12310.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT12310.MA_CHUONG,COT12310.MA_NGUON_NSNN, COT12310.MA_DVQHNS, COT12310.TEN_DVQHNS, COT12310.MA_NGANHKT, COT12310.TONGSO_LK_NT, COT12310.VONTUCTH_NT, COT12310.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12310.KHDTN) COT123410
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT123410.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123410.MA_DVQHNS = COT5.MA_DVQHNS AND COT123410.MA_NGANHKT = COT5.MA_NGANHKT AND COT123410.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT123410.MA_CHUONG,COT123410.MA_NGUON_NSNN, COT123410.MA_DVQHNS, COT123410.TEN_DVQHNS, COT123410.MA_NGANHKT, COT123410.TONGSO_LK_NT, COT123410.VONTUCTH_NT, COT123410.VONTUCTH_DC, COT123410.TT_KLHT_NT, COT5.KHVKD,COT123410.KHDTN) COT1234510
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT1234510.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234510.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234510.MA_NGANHKT = COT6.MA_NGANHKT AND COT1234510.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT1234510.MA_CHUONG,COT1234510.MA_NGUON_NSNN, COT1234510.MA_DVQHNS, COT1234510.TEN_DVQHNS, COT1234510.MA_NGANHKT, COT1234510.TONGSO_LK_NT, COT1234510.VONTUCTH_NT, COT1234510.VONTUCTH_DC, COT1234510.TT_KLHT_NT, COT1234510.KHVKD,COT6.KLHT,COT1234510.KHDTN) COT12345610
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT12345610.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345610.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345610.MA_NGANHKT = COT7.MA_NGANHKT AND COT12345610.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT12345610.MA_CHUONG,COT12345610.MA_NGUON_NSNN, COT12345610.MA_DVQHNS, COT12345610.TEN_DVQHNS, COT12345610.MA_NGANHKT, COT12345610.TONGSO_LK_NT, COT12345610.VONTUCTH_NT, COT12345610.VONTUCTH_DC, COT12345610.TT_KLHT_NT, COT12345610.KHVKD,COT12345610.KLHT,COT7.HOANUNG,COT12345610.KHDTN) COT123456710
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT123456710.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456710.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456710.MA_NGANHKT = COT8.MA_NGANHKT AND COT123456710.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT123456710.MA_CHUONG,COT123456710.MA_NGUON_NSNN, COT123456710.MA_DVQHNS, COT123456710.TEN_DVQHNS, COT123456710.MA_NGANHKT, COT123456710.TONGSO_LK_NT, COT123456710.VONTUCTH_NT, COT123456710.VONTUCTH_DC, COT123456710.TT_KLHT_NT, COT123456710.KHVKD,COT123456710.KLHT,COT123456710.HOANUNG, COT8.VTUCTH,COT123456710.KHDTN) COT1234567810
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT1234567810.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567810.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567810.MA_NGANHKT = COT9.MA_NGANHKT AND COT1234567810.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT1234567810.MA_CHUONG,COT1234567810.MA_NGUON_NSNN, COT1234567810.MA_DVQHNS, COT1234567810.TEN_DVQHNS, COT1234567810.MA_NGANHKT, COT1234567810.TONGSO_LK_NT, COT1234567810.VONTUCTH_NT, COT1234567810.VONTUCTH_DC, COT1234567810.TT_KLHT_NT, COT1234567810.KHVKD,COT1234567810.KLHT,COT1234567810.HOANUNG, COT1234567810.VTUCTH, COT9.KHVNS,COT1234567810.KHDTN) COT12345678910
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT12345678910.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT12345678910.MA_DVQHNS = COT11.MA_DVQHNS AND COT12345678910.MA_NGANHKT = COT11.MA_NGANHKT AND COT12345678910.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT12345678910.MA_CHUONG,COT12345678910.MA_NGUON_NSNN, COT12345678910.MA_DVQHNS, COT12345678910.TEN_DVQHNS, COT12345678910.MA_NGANHKT, COT12345678910.TONGSO_LK_NT, COT12345678910.VONTUCTH_NT, COT12345678910.VONTUCTH_DC, COT12345678910.TT_KLHT_NT, COT12345678910.KHVKD,COT12345678910.KLHT,COT12345678910.HOANUNG, COT12345678910.VTUCTH, COT12345678910.KHVNS, COT12345678910.KHDTN, COT11.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR10:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM FROM
(SELECT COT12345678911.MA_CHUONG,COT12345678911.MA_NGUON_NSNN, COT12345678911.MA_DVQHNS, COT12345678911.TEN_DVQHNS, COT12345678911.MA_NGANHKT, COT12345678911.TONGSO_LK_NT, COT12345678911.VONTUCTH_NT, COT12345678911.VONTUCTH_DC, COT12345678911.TT_KLHT_NT, COT12345678911.KHVKD,COT12345678911.KLHT,COT12345678911.HOANUNG, COT12345678911.VTUCTH, COT12345678911.KHVNS, COT10.KHDTN,COT12345678911.KLHTN FROM
(SELECT COT1234567811.MA_CHUONG,COT1234567811.MA_NGUON_NSNN, COT1234567811.MA_DVQHNS, COT1234567811.TEN_DVQHNS, COT1234567811.MA_NGANHKT, COT1234567811.TONGSO_LK_NT, COT1234567811.VONTUCTH_NT, COT1234567811.VONTUCTH_DC, COT1234567811.TT_KLHT_NT, COT1234567811.KHVKD,COT1234567811.KLHT,COT1234567811.HOANUNG, COT1234567811.VTUCTH, COT9.KHVNS,COT1234567811.KLHTN FROM
(SELECT COT123456711.MA_CHUONG,COT123456711.MA_NGUON_NSNN, COT123456711.MA_DVQHNS, COT123456711.TEN_DVQHNS, COT123456711.MA_NGANHKT, COT123456711.TONGSO_LK_NT, COT123456711.VONTUCTH_NT, COT123456711.VONTUCTH_DC, COT123456711.TT_KLHT_NT, COT123456711.KHVKD,COT123456711.KLHT,COT123456711.HOANUNG, COT8.VTUCTH,COT123456711.KLHTN FROM
(SELECT COT12345611.MA_CHUONG,COT12345611.MA_NGUON_NSNN, COT12345611.MA_DVQHNS, COT12345611.TEN_DVQHNS, COT12345611.MA_NGANHKT, COT12345611.TONGSO_LK_NT, COT12345611.VONTUCTH_NT, COT12345611.VONTUCTH_DC, COT12345611.TT_KLHT_NT, COT12345611.KHVKD,COT12345611.KLHT,COT7.HOANUNG,COT12345611.KLHTN FROM
(SELECT COT1234511.MA_CHUONG,COT1234511.MA_NGUON_NSNN, COT1234511.MA_DVQHNS, COT1234511.TEN_DVQHNS, COT1234511.MA_NGANHKT, COT1234511.TONGSO_LK_NT, COT1234511.VONTUCTH_NT, COT1234511.VONTUCTH_DC, COT1234511.TT_KLHT_NT, COT1234511.KHVKD,COT6.KLHT,COT1234511.KLHTN FROM
(SELECT COT123411.MA_CHUONG,COT123411.MA_NGUON_NSNN, COT123411.MA_DVQHNS, COT123411.TEN_DVQHNS, COT123411.MA_NGANHKT, COT123411.TONGSO_LK_NT, COT123411.VONTUCTH_NT, COT123411.VONTUCTH_DC, COT123411.TT_KLHT_NT, COT5.KHVKD,COT123411.KLHTN FROM
(SELECT COT12311.MA_CHUONG,COT12311.MA_NGUON_NSNN, COT12311.MA_DVQHNS, COT12311.TEN_DVQHNS, COT12311.MA_NGANHKT, COT12311.TONGSO_LK_NT, COT12311.VONTUCTH_NT, COT12311.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12311.KLHTN FROM
(SELECT COT1211.MA_CHUONG,COT1211.MA_NGUON_NSNN, COT1211.MA_DVQHNS, COT1211.TEN_DVQHNS, COT1211.MA_NGANHKT, COT1211.TONGSO_LK_NT, COT1211.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1211.KLHTN FROM
(SELECT COT111.MA_CHUONG,COT111.MA_NGUON_NSNN, COT111.MA_DVQHNS, COT111.TEN_DVQHNS, COT111.MA_NGANHKT, COT111.TONGSO_LK_NT, COT2.VONTUCTH_NT, COT111.KLHTN FROM
(SELECT COT11.MA_CHUONG,COT11.MA_NGUON_NSNN, COT11.MA_DVQHNS, COT11.TEN_DVQHNS, COT11.MA_NGANHKT, COT1.TONGSO_LK_NT, COT11.KLHTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT11.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT11.MA_DVQHNS = COT1.MA_DVQHNS AND COT11.MA_NGANHKT = COT1.MA_NGANHKT AND COT11.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT11.MA_CHUONG,COT11.MA_NGUON_NSNN, COT11.MA_DVQHNS, COT11.TEN_DVQHNS, COT11.MA_NGANHKT, COT1.TONGSO_LK_NT, COT11.KLHTN) COT111
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT111.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT111.MA_DVQHNS = COT2.MA_DVQHNS AND COT111.MA_NGANHKT = COT2.MA_NGANHKT AND COT111.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT111.MA_CHUONG,COT111.MA_NGUON_NSNN, COT111.MA_DVQHNS, COT111.TEN_DVQHNS, COT111.MA_NGANHKT, COT111.TONGSO_LK_NT, COT2.VONTUCTH_NT, COT111.KLHTN) COT1211
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT1211.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1211.MA_DVQHNS = COT3.MA_DVQHNS AND COT1211.MA_NGANHKT = COT3.MA_NGANHKT AND COT1211.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT1211.MA_CHUONG,COT1211.MA_NGUON_NSNN, COT1211.MA_DVQHNS, COT1211.TEN_DVQHNS, COT1211.MA_NGANHKT, COT1211.TONGSO_LK_NT, COT1211.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1211.KLHTN) COT12311
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT12311.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12311.MA_DVQHNS = COT4.MA_DVQHNS AND COT12311.MA_NGANHKT = COT4.MA_NGANHKT AND COT12311.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT12311.MA_CHUONG,COT12311.MA_NGUON_NSNN, COT12311.MA_DVQHNS, COT12311.TEN_DVQHNS, COT12311.MA_NGANHKT, COT12311.TONGSO_LK_NT, COT12311.VONTUCTH_NT, COT12311.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12311.KLHTN) COT123411
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT123411.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123411.MA_DVQHNS = COT5.MA_DVQHNS AND COT123411.MA_NGANHKT = COT5.MA_NGANHKT AND COT123411.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT123411.MA_CHUONG,COT123411.MA_NGUON_NSNN, COT123411.MA_DVQHNS, COT123411.TEN_DVQHNS, COT123411.MA_NGANHKT, COT123411.TONGSO_LK_NT, COT123411.VONTUCTH_NT, COT123411.VONTUCTH_DC, COT123411.TT_KLHT_NT, COT5.KHVKD,COT123411.KLHTN) COT1234511
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT1234511.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234511.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234511.MA_NGANHKT = COT6.MA_NGANHKT AND COT1234511.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT1234511.MA_CHUONG,COT1234511.MA_NGUON_NSNN, COT1234511.MA_DVQHNS, COT1234511.TEN_DVQHNS, COT1234511.MA_NGANHKT, COT1234511.TONGSO_LK_NT, COT1234511.VONTUCTH_NT, COT1234511.VONTUCTH_DC, COT1234511.TT_KLHT_NT, COT1234511.KHVKD,COT6.KLHT,COT1234511.KLHTN) COT12345611
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT12345611.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345611.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345611.MA_NGANHKT = COT7.MA_NGANHKT AND COT12345611.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT12345611.MA_CHUONG,COT12345611.MA_NGUON_NSNN, COT12345611.MA_DVQHNS, COT12345611.TEN_DVQHNS, COT12345611.MA_NGANHKT, COT12345611.TONGSO_LK_NT, COT12345611.VONTUCTH_NT, COT12345611.VONTUCTH_DC, COT12345611.TT_KLHT_NT, COT12345611.KHVKD,COT12345611.KLHT,COT7.HOANUNG,COT12345611.KLHTN) COT123456711
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT123456711.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456711.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456711.MA_NGANHKT = COT8.MA_NGANHKT AND COT123456711.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT123456711.MA_CHUONG,COT123456711.MA_NGUON_NSNN, COT123456711.MA_DVQHNS, COT123456711.TEN_DVQHNS, COT123456711.MA_NGANHKT, COT123456711.TONGSO_LK_NT, COT123456711.VONTUCTH_NT, COT123456711.VONTUCTH_DC, COT123456711.TT_KLHT_NT, COT123456711.KHVKD,COT123456711.KLHT,COT123456711.HOANUNG, COT8.VTUCTH,COT123456711.KLHTN) COT1234567811
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT1234567811.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567811.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567811.MA_NGANHKT = COT9.MA_NGANHKT AND COT1234567811.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT1234567811.MA_CHUONG,COT1234567811.MA_NGUON_NSNN, COT1234567811.MA_DVQHNS, COT1234567811.TEN_DVQHNS, COT1234567811.MA_NGANHKT, COT1234567811.TONGSO_LK_NT, COT1234567811.VONTUCTH_NT, COT1234567811.VONTUCTH_DC, COT1234567811.TT_KLHT_NT, COT1234567811.KHVKD,COT1234567811.KLHT,COT1234567811.HOANUNG, COT1234567811.VTUCTH, COT9.KHVNS,COT1234567811.KLHTN) COT12345678911
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT12345678911.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT12345678911.MA_DVQHNS = COT10.MA_DVQHNS AND COT12345678911.MA_NGANHKT = COT10.MA_NGANHKT AND COT12345678911.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT12345678911.MA_CHUONG,COT12345678911.MA_NGUON_NSNN, COT12345678911.MA_DVQHNS, COT12345678911.TEN_DVQHNS, COT12345678911.MA_NGANHKT, COT12345678911.TONGSO_LK_NT, COT12345678911.VONTUCTH_NT, COT12345678911.VONTUCTH_DC, COT12345678911.TT_KLHT_NT, COT12345678911.KHVKD,COT12345678911.KLHT,COT12345678911.HOANUNG, COT12345678911.VTUCTH, COT12345678911.KHVNS, COT10.KHDTN,COT12345678911.KLHTN) COT1234567891011
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT1234567891011.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT1234567891011.MA_DVQHNS = COT12.MA_DVQHNS AND COT1234567891011.MA_NGANHKT = COT12.MA_NGANHKT AND COT1234567891011.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT1234567891011.MA_CHUONG,COT1234567891011.MA_NGUON_NSNN, COT1234567891011.MA_DVQHNS, COT1234567891011.TEN_DVQHNS, COT1234567891011.MA_NGANHKT, COT1234567891011.TONGSO_LK_NT, COT1234567891011.VONTUCTH_NT, COT1234567891011.VONTUCTH_DC, COT1234567891011.TT_KLHT_NT, COT1234567891011.KHVKD,COT1234567891011.KLHT,COT1234567891011.HOANUNG, COT1234567891011.VTUCTH, COT1234567891011.KHVNS, COT1234567891011.KHDTN, COT1234567891011.KLHTN, COT12.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR11:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM FROM
(SELECT COT1234567891012.MA_CHUONG,COT1234567891012.MA_NGUON_NSNN, COT1234567891012.MA_DVQHNS, COT1234567891012.TEN_DVQHNS, COT1234567891012.MA_NGANHKT, COT1234567891012.TONGSO_LK_NT, COT1234567891012.VONTUCTH_NT, COT1234567891012.VONTUCTH_DC, COT1234567891012.TT_KLHT_NT, COT1234567891012.KHVKD,COT1234567891012.KLHT,COT1234567891012.HOANUNG, COT1234567891012.VTUCTH, COT1234567891012.KHVNS, COT1234567891012.KHDTN, COT11.KLHTN,COT1234567891012.HOANUNG_NAM FROM
(SELECT COT12345678912.MA_CHUONG,COT12345678912.MA_NGUON_NSNN, COT12345678912.MA_DVQHNS, COT12345678912.TEN_DVQHNS, COT12345678912.MA_NGANHKT, COT12345678912.TONGSO_LK_NT, COT12345678912.VONTUCTH_NT, COT12345678912.VONTUCTH_DC, COT12345678912.TT_KLHT_NT, COT12345678912.KHVKD,COT12345678912.KLHT,COT12345678912.HOANUNG, COT12345678912.VTUCTH, COT12345678912.KHVNS, COT10.KHDTN,COT12345678912.HOANUNG_NAM FROM
(SELECT COT1234567812.MA_CHUONG,COT1234567812.MA_NGUON_NSNN, COT1234567812.MA_DVQHNS, COT1234567812.TEN_DVQHNS, COT1234567812.MA_NGANHKT, COT1234567812.TONGSO_LK_NT, COT1234567812.VONTUCTH_NT, COT1234567812.VONTUCTH_DC, COT1234567812.TT_KLHT_NT, COT1234567812.KHVKD,COT1234567812.KLHT,COT1234567812.HOANUNG, COT1234567812.VTUCTH, COT9.KHVNS,COT1234567812.HOANUNG_NAM FROM
(SELECT COT123456712.MA_CHUONG,COT123456712.MA_NGUON_NSNN, COT123456712.MA_DVQHNS, COT123456712.TEN_DVQHNS, COT123456712.MA_NGANHKT, COT123456712.TONGSO_LK_NT, COT123456712.VONTUCTH_NT, COT123456712.VONTUCTH_DC, COT123456712.TT_KLHT_NT, COT123456712.KHVKD,COT123456712.KLHT,COT123456712.HOANUNG, COT8.VTUCTH,COT123456712.HOANUNG_NAM FROM
(SELECT COT12345612.MA_CHUONG,COT12345612.MA_NGUON_NSNN, COT12345612.MA_DVQHNS, COT12345612.TEN_DVQHNS, COT12345612.MA_NGANHKT, COT12345612.TONGSO_LK_NT, COT12345612.VONTUCTH_NT, COT12345612.VONTUCTH_DC, COT12345612.TT_KLHT_NT, COT12345612.KHVKD,COT12345612.KLHT,COT7.HOANUNG,COT12345612.HOANUNG_NAM FROM
(SELECT COT1234512.MA_CHUONG,COT1234512.MA_NGUON_NSNN, COT1234512.MA_DVQHNS, COT1234512.TEN_DVQHNS, COT1234512.MA_NGANHKT, COT1234512.TONGSO_LK_NT, COT1234512.VONTUCTH_NT, COT1234512.VONTUCTH_DC, COT1234512.TT_KLHT_NT, COT1234512.KHVKD,COT6.KLHT,COT1234512.HOANUNG_NAM FROM
(SELECT COT123412.MA_CHUONG,COT123412.MA_NGUON_NSNN, COT123412.MA_DVQHNS, COT123412.TEN_DVQHNS, COT123412.MA_NGANHKT, COT123412.TONGSO_LK_NT, COT123412.VONTUCTH_NT, COT123412.VONTUCTH_DC, COT123412.TT_KLHT_NT, COT5.KHVKD,COT123412.HOANUNG_NAM FROM
(SELECT COT12312.MA_CHUONG,COT12312.MA_NGUON_NSNN, COT12312.MA_DVQHNS, COT12312.TEN_DVQHNS, COT12312.MA_NGANHKT, COT12312.TONGSO_LK_NT, COT12312.VONTUCTH_NT, COT12312.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12312.HOANUNG_NAM FROM
(SELECT COT1212.MA_CHUONG,COT1212.MA_NGUON_NSNN, COT1212.MA_DVQHNS, COT1212.TEN_DVQHNS, COT1212.MA_NGANHKT, COT1212.TONGSO_LK_NT, COT1212.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1212.HOANUNG_NAM FROM
(SELECT COT112.MA_CHUONG,COT112.MA_NGUON_NSNN, COT112.MA_DVQHNS, COT112.TEN_DVQHNS, COT112.MA_NGANHKT, COT112.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT112.HOANUNG_NAM FROM
(SELECT COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT1.TONGSO_LK_NT, COT12.HOANUNG_NAM FROM
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT12.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT12.MA_DVQHNS = COT1.MA_DVQHNS AND COT12.MA_NGANHKT = COT1.MA_NGANHKT AND COT12.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT12.MA_CHUONG,COT12.MA_NGUON_NSNN, COT12.MA_DVQHNS, COT12.TEN_DVQHNS, COT12.MA_NGANHKT, COT1.TONGSO_LK_NT, COT12.HOANUNG_NAM) COT112
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT112.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT112.MA_DVQHNS = COT2.MA_DVQHNS AND COT112.MA_NGANHKT = COT2.MA_NGANHKT AND COT112.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT112.MA_CHUONG,COT112.MA_NGUON_NSNN, COT112.MA_DVQHNS, COT112.TEN_DVQHNS, COT112.MA_NGANHKT, COT112.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT112.HOANUNG_NAM) COT1212
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT1212.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1212.MA_DVQHNS = COT3.MA_DVQHNS AND COT1212.MA_NGANHKT = COT3.MA_NGANHKT AND COT1212.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT1212.MA_CHUONG,COT1212.MA_NGUON_NSNN, COT1212.MA_DVQHNS, COT1212.TEN_DVQHNS, COT1212.MA_NGANHKT, COT1212.TONGSO_LK_NT, COT1212.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1212.HOANUNG_NAM) COT12312
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT12312.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12312.MA_DVQHNS = COT4.MA_DVQHNS AND COT12312.MA_NGANHKT = COT4.MA_NGANHKT AND COT12312.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT12312.MA_CHUONG,COT12312.MA_NGUON_NSNN, COT12312.MA_DVQHNS, COT12312.TEN_DVQHNS, COT12312.MA_NGANHKT, COT12312.TONGSO_LK_NT, COT12312.VONTUCTH_NT, COT12312.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12312.HOANUNG_NAM) COT123412
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT123412.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123412.MA_DVQHNS = COT5.MA_DVQHNS AND COT123412.MA_NGANHKT = COT5.MA_NGANHKT AND COT123412.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT123412.MA_CHUONG,COT123412.MA_NGUON_NSNN, COT123412.MA_DVQHNS, COT123412.TEN_DVQHNS, COT123412.MA_NGANHKT, COT123412.TONGSO_LK_NT, COT123412.VONTUCTH_NT, COT123412.VONTUCTH_DC, COT123412.TT_KLHT_NT, COT5.KHVKD,COT123412.HOANUNG_NAM) COT1234512
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT1234512.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234512.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234512.MA_NGANHKT = COT6.MA_NGANHKT AND COT1234512.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT1234512.MA_CHUONG,COT1234512.MA_NGUON_NSNN, COT1234512.MA_DVQHNS, COT1234512.TEN_DVQHNS, COT1234512.MA_NGANHKT, COT1234512.TONGSO_LK_NT, COT1234512.VONTUCTH_NT, COT1234512.VONTUCTH_DC, COT1234512.TT_KLHT_NT, COT1234512.KHVKD,COT6.KLHT,COT1234512.HOANUNG_NAM) COT12345612
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT12345612.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345612.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345612.MA_NGANHKT = COT7.MA_NGANHKT AND COT12345612.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT12345612.MA_CHUONG,COT12345612.MA_NGUON_NSNN, COT12345612.MA_DVQHNS, COT12345612.TEN_DVQHNS, COT12345612.MA_NGANHKT, COT12345612.TONGSO_LK_NT, COT12345612.VONTUCTH_NT, COT12345612.VONTUCTH_DC, COT12345612.TT_KLHT_NT, COT12345612.KHVKD,COT12345612.KLHT,COT7.HOANUNG,COT12345612.HOANUNG_NAM) COT123456712
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT123456712.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456712.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456712.MA_NGANHKT = COT8.MA_NGANHKT AND COT123456712.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT123456712.MA_CHUONG,COT123456712.MA_NGUON_NSNN, COT123456712.MA_DVQHNS, COT123456712.TEN_DVQHNS, COT123456712.MA_NGANHKT, COT123456712.TONGSO_LK_NT, COT123456712.VONTUCTH_NT, COT123456712.VONTUCTH_DC, COT123456712.TT_KLHT_NT, COT123456712.KHVKD,COT123456712.KLHT,COT123456712.HOANUNG, COT8.VTUCTH,COT123456712.HOANUNG_NAM) COT1234567812
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT1234567812.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567812.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567812.MA_NGANHKT = COT9.MA_NGANHKT AND COT1234567812.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT1234567812.MA_CHUONG,COT1234567812.MA_NGUON_NSNN, COT1234567812.MA_DVQHNS, COT1234567812.TEN_DVQHNS, COT1234567812.MA_NGANHKT, COT1234567812.TONGSO_LK_NT, COT1234567812.VONTUCTH_NT, COT1234567812.VONTUCTH_DC, COT1234567812.TT_KLHT_NT, COT1234567812.KHVKD,COT1234567812.KLHT,COT1234567812.HOANUNG, COT1234567812.VTUCTH, COT9.KHVNS,COT1234567812.HOANUNG_NAM) COT12345678912
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT12345678912.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT12345678912.MA_DVQHNS = COT10.MA_DVQHNS AND COT12345678912.MA_NGANHKT = COT10.MA_NGANHKT AND COT12345678912.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT12345678912.MA_CHUONG,COT12345678912.MA_NGUON_NSNN, COT12345678912.MA_DVQHNS, COT12345678912.TEN_DVQHNS, COT12345678912.MA_NGANHKT, COT12345678912.TONGSO_LK_NT, COT12345678912.VONTUCTH_NT, COT12345678912.VONTUCTH_DC, COT12345678912.TT_KLHT_NT, COT12345678912.KHVKD,COT12345678912.KLHT,COT12345678912.HOANUNG, COT12345678912.VTUCTH, COT12345678912.KHVNS, COT10.KHDTN,COT12345678912.HOANUNG_NAM) COT1234567891012
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT1234567891012.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT1234567891012.MA_DVQHNS = COT11.MA_DVQHNS AND COT1234567891012.MA_NGANHKT = COT11.MA_NGANHKT AND COT1234567891012.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT1234567891012.MA_CHUONG,COT1234567891012.MA_NGUON_NSNN, COT1234567891012.MA_DVQHNS, COT1234567891012.TEN_DVQHNS, COT1234567891012.MA_NGANHKT, COT1234567891012.TONGSO_LK_NT, COT1234567891012.VONTUCTH_NT, COT1234567891012.VONTUCTH_DC, COT1234567891012.TT_KLHT_NT, COT1234567891012.KHVKD,COT1234567891012.KLHT,COT1234567891012.HOANUNG, COT1234567891012.VTUCTH, COT1234567891012.KHVNS, COT1234567891012.KHDTN, COT11.KLHTN,COT1234567891012.HOANUNG_NAM) COT123456789101112
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT123456789101112.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT123456789101112.MA_DVQHNS = COT13.MA_DVQHNS AND COT123456789101112.MA_NGANHKT = COT13.MA_NGANHKT AND COT123456789101112.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT123456789101112.MA_CHUONG,COT123456789101112.MA_NGUON_NSNN, COT123456789101112.MA_DVQHNS, COT123456789101112.TEN_DVQHNS, COT123456789101112.MA_NGANHKT, COT123456789101112.TONGSO_LK_NT, COT123456789101112.VONTUCTH_NT, COT123456789101112.VONTUCTH_DC, COT123456789101112.TT_KLHT_NT, COT123456789101112.KHVKD,COT123456789101112.KLHT,COT123456789101112.HOANUNG, COT123456789101112.VTUCTH, COT123456789101112.KHVNS, COT123456789101112.KHDTN, COT123456789101112.KLHTN, COT123456789101112.HOANUNG_NAM,COT13.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR12:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM FROM
(SELECT COT123456789101113.MA_CHUONG,COT123456789101113.MA_NGUON_NSNN, COT123456789101113.MA_DVQHNS, COT123456789101113.TEN_DVQHNS, COT123456789101113.MA_NGANHKT, COT123456789101113.TONGSO_LK_NT, COT123456789101113.VONTUCTH_NT, COT123456789101113.VONTUCTH_DC, COT123456789101113.TT_KLHT_NT, COT123456789101113.KHVKD,COT123456789101113.KLHT,COT123456789101113.HOANUNG, COT123456789101113.VTUCTH, COT123456789101113.KHVNS, COT123456789101113.KHDTN, COT123456789101113.KLHTN, COT12.HOANUNG_NAM,COT123456789101113.VTUCTH_NAM FROM
(SELECT COT1234567891013.MA_CHUONG,COT1234567891013.MA_NGUON_NSNN, COT1234567891013.MA_DVQHNS, COT1234567891013.TEN_DVQHNS, COT1234567891013.MA_NGANHKT, COT1234567891013.TONGSO_LK_NT, COT1234567891013.VONTUCTH_NT, COT1234567891013.VONTUCTH_DC, COT1234567891013.TT_KLHT_NT, COT1234567891013.KHVKD,COT1234567891013.KLHT,COT1234567891013.HOANUNG, COT1234567891013.VTUCTH, COT1234567891013.KHVNS, COT1234567891013.KHDTN, COT11.KLHTN,COT1234567891013.VTUCTH_NAM FROM
(SELECT COT12345678913.MA_CHUONG,COT12345678913.MA_NGUON_NSNN, COT12345678913.MA_DVQHNS, COT12345678913.TEN_DVQHNS, COT12345678913.MA_NGANHKT, COT12345678913.TONGSO_LK_NT, COT12345678913.VONTUCTH_NT, COT12345678913.VONTUCTH_DC, COT12345678913.TT_KLHT_NT, COT12345678913.KHVKD,COT12345678913.KLHT,COT12345678913.HOANUNG, COT12345678913.VTUCTH, COT12345678913.KHVNS, COT10.KHDTN,COT12345678913.VTUCTH_NAM FROM
(SELECT COT1234567813.MA_CHUONG,COT1234567813.MA_NGUON_NSNN, COT1234567813.MA_DVQHNS, COT1234567813.TEN_DVQHNS, COT1234567813.MA_NGANHKT, COT1234567813.TONGSO_LK_NT, COT1234567813.VONTUCTH_NT, COT1234567813.VONTUCTH_DC, COT1234567813.TT_KLHT_NT, COT1234567813.KHVKD,COT1234567813.KLHT,COT1234567813.HOANUNG, COT1234567813.VTUCTH, COT9.KHVNS,COT1234567813.VTUCTH_NAM FROM
(SELECT COT123456713.MA_CHUONG,COT123456713.MA_NGUON_NSNN, COT123456713.MA_DVQHNS, COT123456713.TEN_DVQHNS, COT123456713.MA_NGANHKT, COT123456713.TONGSO_LK_NT, COT123456713.VONTUCTH_NT, COT123456713.VONTUCTH_DC, COT123456713.TT_KLHT_NT, COT123456713.KHVKD,COT123456713.KLHT,COT123456713.HOANUNG, COT8.VTUCTH,COT123456713.VTUCTH_NAM FROM
(SELECT COT12345613.MA_CHUONG,COT12345613.MA_NGUON_NSNN, COT12345613.MA_DVQHNS, COT12345613.TEN_DVQHNS, COT12345613.MA_NGANHKT, COT12345613.TONGSO_LK_NT, COT12345613.VONTUCTH_NT, COT12345613.VONTUCTH_DC, COT12345613.TT_KLHT_NT, COT12345613.KHVKD,COT12345613.KLHT,COT7.HOANUNG,COT12345613.VTUCTH_NAM FROM
(SELECT COT1234513.MA_CHUONG,COT1234513.MA_NGUON_NSNN, COT1234513.MA_DVQHNS, COT1234513.TEN_DVQHNS, COT1234513.MA_NGANHKT, COT1234513.TONGSO_LK_NT, COT1234513.VONTUCTH_NT, COT1234513.VONTUCTH_DC, COT1234513.TT_KLHT_NT, COT1234513.KHVKD,COT6.KLHT,COT1234513.VTUCTH_NAM FROM
(SELECT COT123413.MA_CHUONG,COT123413.MA_NGUON_NSNN, COT123413.MA_DVQHNS, COT123413.TEN_DVQHNS, COT123413.MA_NGANHKT, COT123413.TONGSO_LK_NT, COT123413.VONTUCTH_NT, COT123413.VONTUCTH_DC, COT123413.TT_KLHT_NT, COT5.KHVKD,COT123413.VTUCTH_NAM FROM
(SELECT COT12313.MA_CHUONG,COT12313.MA_NGUON_NSNN, COT12313.MA_DVQHNS, COT12313.TEN_DVQHNS, COT12313.MA_NGANHKT, COT12313.TONGSO_LK_NT, COT12313.VONTUCTH_NT, COT12313.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12313.VTUCTH_NAM FROM
(SELECT COT1213.MA_CHUONG,COT1213.MA_NGUON_NSNN, COT1213.MA_DVQHNS, COT1213.TEN_DVQHNS, COT1213.MA_NGANHKT, COT1213.TONGSO_LK_NT, COT1213.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1213.VTUCTH_NAM FROM
(SELECT COT113.MA_CHUONG,COT113.MA_NGUON_NSNN, COT113.MA_DVQHNS, COT113.TEN_DVQHNS, COT113.MA_NGANHKT, COT113.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT113.VTUCTH_NAM FROM
(SELECT COT13.MA_CHUONG,COT13.MA_NGUON_NSNN, COT13.MA_DVQHNS, COT13.TEN_DVQHNS, COT13.MA_NGANHKT, COT1.TONGSO_LK_NT, COT13.VTUCTH_NAM FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT13.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT13.MA_DVQHNS = COT1.MA_DVQHNS AND COT13.MA_NGANHKT = COT1.MA_NGANHKT AND COT13.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT13.MA_CHUONG,COT13.MA_NGUON_NSNN, COT13.MA_DVQHNS, COT13.TEN_DVQHNS, COT13.MA_NGANHKT, COT1.TONGSO_LK_NT, COT13.VTUCTH_NAM) COT113
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT113.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT113.MA_DVQHNS = COT2.MA_DVQHNS AND COT113.MA_NGANHKT = COT2.MA_NGANHKT AND COT113.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT113.MA_CHUONG,COT113.MA_NGUON_NSNN, COT113.MA_DVQHNS, COT113.TEN_DVQHNS, COT113.MA_NGANHKT, COT113.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT113.VTUCTH_NAM) COT1213
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT1213.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1213.MA_DVQHNS = COT3.MA_DVQHNS AND COT1213.MA_NGANHKT = COT3.MA_NGANHKT AND COT1213.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT1213.MA_CHUONG,COT1213.MA_NGUON_NSNN, COT1213.MA_DVQHNS, COT1213.TEN_DVQHNS, COT1213.MA_NGANHKT, COT1213.TONGSO_LK_NT, COT1213.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1213.VTUCTH_NAM) COT12313
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT12313.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12313.MA_DVQHNS = COT4.MA_DVQHNS AND COT12313.MA_NGANHKT = COT4.MA_NGANHKT AND COT12313.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT12313.MA_CHUONG,COT12313.MA_NGUON_NSNN, COT12313.MA_DVQHNS, COT12313.TEN_DVQHNS, COT12313.MA_NGANHKT, COT12313.TONGSO_LK_NT, COT12313.VONTUCTH_NT, COT12313.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12313.VTUCTH_NAM) COT123413
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT123413.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123413.MA_DVQHNS = COT5.MA_DVQHNS AND COT123413.MA_NGANHKT = COT5.MA_NGANHKT AND COT123413.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT123413.MA_CHUONG,COT123413.MA_NGUON_NSNN, COT123413.MA_DVQHNS, COT123413.TEN_DVQHNS, COT123413.MA_NGANHKT, COT123413.TONGSO_LK_NT, COT123413.VONTUCTH_NT, COT123413.VONTUCTH_DC, COT123413.TT_KLHT_NT, COT5.KHVKD,COT123413.VTUCTH_NAM) COT1234513
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT1234513.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234513.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234513.MA_NGANHKT = COT6.MA_NGANHKT AND COT1234513.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT1234513.MA_CHUONG,COT1234513.MA_NGUON_NSNN, COT1234513.MA_DVQHNS, COT1234513.TEN_DVQHNS, COT1234513.MA_NGANHKT, COT1234513.TONGSO_LK_NT, COT1234513.VONTUCTH_NT, COT1234513.VONTUCTH_DC, COT1234513.TT_KLHT_NT, COT1234513.KHVKD,COT6.KLHT,COT1234513.VTUCTH_NAM) COT12345613
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT12345613.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345613.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345613.MA_NGANHKT = COT7.MA_NGANHKT AND COT12345613.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT12345613.MA_CHUONG,COT12345613.MA_NGUON_NSNN, COT12345613.MA_DVQHNS, COT12345613.TEN_DVQHNS, COT12345613.MA_NGANHKT, COT12345613.TONGSO_LK_NT, COT12345613.VONTUCTH_NT, COT12345613.VONTUCTH_DC, COT12345613.TT_KLHT_NT, COT12345613.KHVKD,COT12345613.KLHT,COT7.HOANUNG,COT12345613.VTUCTH_NAM) COT123456713
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT123456713.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456713.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456713.MA_NGANHKT = COT8.MA_NGANHKT AND COT123456713.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT123456713.MA_CHUONG,COT123456713.MA_NGUON_NSNN, COT123456713.MA_DVQHNS, COT123456713.TEN_DVQHNS, COT123456713.MA_NGANHKT, COT123456713.TONGSO_LK_NT, COT123456713.VONTUCTH_NT, COT123456713.VONTUCTH_DC, COT123456713.TT_KLHT_NT, COT123456713.KHVKD,COT123456713.KLHT,COT123456713.HOANUNG, COT8.VTUCTH,COT123456713.VTUCTH_NAM) COT1234567813
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT1234567813.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567813.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567813.MA_NGANHKT = COT9.MA_NGANHKT AND COT1234567813.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT1234567813.MA_CHUONG,COT1234567813.MA_NGUON_NSNN, COT1234567813.MA_DVQHNS, COT1234567813.TEN_DVQHNS, COT1234567813.MA_NGANHKT, COT1234567813.TONGSO_LK_NT, COT1234567813.VONTUCTH_NT, COT1234567813.VONTUCTH_DC, COT1234567813.TT_KLHT_NT, COT1234567813.KHVKD,COT1234567813.KLHT,COT1234567813.HOANUNG, COT1234567813.VTUCTH, COT9.KHVNS,COT1234567813.VTUCTH_NAM) COT12345678913
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT12345678913.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT12345678913.MA_DVQHNS = COT10.MA_DVQHNS AND COT12345678913.MA_NGANHKT = COT10.MA_NGANHKT AND COT12345678913.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT12345678913.MA_CHUONG,COT12345678913.MA_NGUON_NSNN, COT12345678913.MA_DVQHNS, COT12345678913.TEN_DVQHNS, COT12345678913.MA_NGANHKT, COT12345678913.TONGSO_LK_NT, COT12345678913.VONTUCTH_NT, COT12345678913.VONTUCTH_DC, COT12345678913.TT_KLHT_NT, COT12345678913.KHVKD,COT12345678913.KLHT,COT12345678913.HOANUNG, COT12345678913.VTUCTH, COT12345678913.KHVNS, COT10.KHDTN,COT12345678913.VTUCTH_NAM) COT1234567891013
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT1234567891013.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT1234567891013.MA_DVQHNS = COT11.MA_DVQHNS AND COT1234567891013.MA_NGANHKT = COT11.MA_NGANHKT AND COT1234567891013.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT1234567891013.MA_CHUONG,COT1234567891013.MA_NGUON_NSNN, COT1234567891013.MA_DVQHNS, COT1234567891013.TEN_DVQHNS, COT1234567891013.MA_NGANHKT, COT1234567891013.TONGSO_LK_NT, COT1234567891013.VONTUCTH_NT, COT1234567891013.VONTUCTH_DC, COT1234567891013.TT_KLHT_NT, COT1234567891013.KHVKD,COT1234567891013.KLHT,COT1234567891013.HOANUNG, COT1234567891013.VTUCTH, COT1234567891013.KHVNS, COT1234567891013.KHDTN, COT11.KLHTN,COT1234567891013.VTUCTH_NAM) COT123456789101113
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT123456789101113.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT123456789101113.MA_DVQHNS = COT12.MA_DVQHNS AND COT123456789101113.MA_NGANHKT = COT12.MA_NGANHKT AND COT123456789101113.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT123456789101113.MA_CHUONG,COT123456789101113.MA_NGUON_NSNN, COT123456789101113.MA_DVQHNS, COT123456789101113.TEN_DVQHNS, COT123456789101113.MA_NGANHKT, COT123456789101113.TONGSO_LK_NT, COT123456789101113.VONTUCTH_NT, COT123456789101113.VONTUCTH_DC, COT123456789101113.TT_KLHT_NT, COT123456789101113.KHVKD,COT123456789101113.KLHT,COT123456789101113.HOANUNG, COT123456789101113.VTUCTH, COT123456789101113.KHVNS, COT123456789101113.KHDTN, COT123456789101113.KLHTN, COT12.HOANUNG_NAM,COT123456789101113.VTUCTH_NAM) COT12345678910111213
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 ON COT12345678910111213.MA_NGUON_NSNN = COT14.MA_NGUON_NSNN AND COT12345678910111213.MA_DVQHNS = COT14.MA_DVQHNS AND COT12345678910111213.MA_NGANHKT = COT14.MA_NGANHKT AND COT12345678910111213.MA_CHUONG = COT14.MA_CHUONG
GROUP BY COT12345678910111213.MA_CHUONG,COT12345678910111213.MA_NGUON_NSNN, COT12345678910111213.MA_DVQHNS, COT12345678910111213.TEN_DVQHNS, COT12345678910111213.MA_NGANHKT, COT12345678910111213.TONGSO_LK_NT, COT12345678910111213.VONTUCTH_NT, COT12345678910111213.VONTUCTH_DC, COT12345678910111213.TT_KLHT_NT, COT12345678910111213.KHVKD,COT12345678910111213.KLHT,COT12345678910111213.HOANUNG, COT12345678910111213.VTUCTH, COT12345678910111213.KHVNS, COT12345678910111213.KHDTN, COT12345678910111213.KLHTN, COT12345678910111213.HOANUNG_NAM,COT12345678910111213.VTUCTH_NAM,COT14.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

QUERY_STR13:=' SELECT MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(TONGSO_LK_NT),0) AS TONGSO_LK_NT,NVL(SUM(VONTUCTH_NT),0) AS VONTUCTH_NT,NVL(SUM(VONTUCTH_DC),0) AS VONTUCTH_DC,NVL(SUM(TT_KLHT_NT),0) AS TT_KLHT_NT,NVL(SUM(KHVKD),0) AS KHVKD,NVL(SUM(KLHT-HOANUNG),0) AS KLHT,(NVL(SUM(VTUCTH),0)) AS VTUCTH,NVL(SUM(KHVNS),0) AS KHVNS,(NVL(SUM(KHDTN),0)) AS KHDTN,NVL(SUM(KLHTN-HOANUNG_NAM),0) AS KLHTN,(NVL(SUM(VTUCTH-VTUCTH_NAM),0)) AS VTUCTH_NAM,(NVL(SUM(KHVKD_NAM),0)) AS KHVKD_NAM FROM
(SELECT COT12345678910111214.MA_CHUONG,COT12345678910111214.MA_NGUON_NSNN, COT12345678910111214.MA_DVQHNS, COT12345678910111214.TEN_DVQHNS, COT12345678910111214.MA_NGANHKT, COT12345678910111214.TONGSO_LK_NT, COT12345678910111214.VONTUCTH_NT, COT12345678910111214.VONTUCTH_DC, COT12345678910111214.TT_KLHT_NT, COT12345678910111214.KHVKD,COT12345678910111214.KLHT,COT12345678910111214.HOANUNG, COT12345678910111214.VTUCTH, COT12345678910111214.KHVNS, COT12345678910111214.KHDTN, COT12345678910111214.KLHTN, COT12345678910111214.HOANUNG_NAM,COT13.VTUCTH_NAM,COT12345678910111214.KHVKD_NAM FROM
(SELECT COT123456789101114.MA_CHUONG,COT123456789101114.MA_NGUON_NSNN, COT123456789101114.MA_DVQHNS, COT123456789101114.TEN_DVQHNS, COT123456789101114.MA_NGANHKT, COT123456789101114.TONGSO_LK_NT, COT123456789101114.VONTUCTH_NT, COT123456789101114.VONTUCTH_DC, COT123456789101114.TT_KLHT_NT, COT123456789101114.KHVKD,COT123456789101114.KLHT,COT123456789101114.HOANUNG, COT123456789101114.VTUCTH, COT123456789101114.KHVNS, COT123456789101114.KHDTN, COT123456789101114.KLHTN, COT12.HOANUNG_NAM,COT123456789101114.KHVKD_NAM FROM
(SELECT COT1234567891014.MA_CHUONG,COT1234567891014.MA_NGUON_NSNN, COT1234567891014.MA_DVQHNS, COT1234567891014.TEN_DVQHNS, COT1234567891014.MA_NGANHKT, COT1234567891014.TONGSO_LK_NT, COT1234567891014.VONTUCTH_NT, COT1234567891014.VONTUCTH_DC, COT1234567891014.TT_KLHT_NT, COT1234567891014.KHVKD,COT1234567891014.KLHT,COT1234567891014.HOANUNG, COT1234567891014.VTUCTH, COT1234567891014.KHVNS, COT1234567891014.KHDTN, COT11.KLHTN,COT1234567891014.KHVKD_NAM FROM
(SELECT COT12345678914.MA_CHUONG,COT12345678914.MA_NGUON_NSNN, COT12345678914.MA_DVQHNS, COT12345678914.TEN_DVQHNS, COT12345678914.MA_NGANHKT, COT12345678914.TONGSO_LK_NT, COT12345678914.VONTUCTH_NT, COT12345678914.VONTUCTH_DC, COT12345678914.TT_KLHT_NT, COT12345678914.KHVKD,COT12345678914.KLHT,COT12345678914.HOANUNG, COT12345678914.VTUCTH, COT12345678914.KHVNS, COT10.KHDTN,COT12345678914.KHVKD_NAM FROM
(SELECT COT1234567814.MA_CHUONG,COT1234567814.MA_NGUON_NSNN, COT1234567814.MA_DVQHNS, COT1234567814.TEN_DVQHNS, COT1234567814.MA_NGANHKT, COT1234567814.TONGSO_LK_NT, COT1234567814.VONTUCTH_NT, COT1234567814.VONTUCTH_DC, COT1234567814.TT_KLHT_NT, COT1234567814.KHVKD,COT1234567814.KLHT,COT1234567814.HOANUNG, COT1234567814.VTUCTH, COT9.KHVNS,COT1234567814.KHVKD_NAM FROM
(SELECT COT123456714.MA_CHUONG,COT123456714.MA_NGUON_NSNN, COT123456714.MA_DVQHNS, COT123456714.TEN_DVQHNS, COT123456714.MA_NGANHKT, COT123456714.TONGSO_LK_NT, COT123456714.VONTUCTH_NT, COT123456714.VONTUCTH_DC, COT123456714.TT_KLHT_NT, COT123456714.KHVKD,COT123456714.KLHT,COT123456714.HOANUNG, COT8.VTUCTH,COT123456714.KHVKD_NAM FROM
(SELECT COT12345614.MA_CHUONG,COT12345614.MA_NGUON_NSNN, COT12345614.MA_DVQHNS, COT12345614.TEN_DVQHNS, COT12345614.MA_NGANHKT, COT12345614.TONGSO_LK_NT, COT12345614.VONTUCTH_NT, COT12345614.VONTUCTH_DC, COT12345614.TT_KLHT_NT, COT12345614.KHVKD,COT12345614.KLHT,COT7.HOANUNG,COT12345614.KHVKD_NAM FROM
(SELECT COT1234514.MA_CHUONG,COT1234514.MA_NGUON_NSNN, COT1234514.MA_DVQHNS, COT1234514.TEN_DVQHNS, COT1234514.MA_NGANHKT, COT1234514.TONGSO_LK_NT, COT1234514.VONTUCTH_NT, COT1234514.VONTUCTH_DC, COT1234514.TT_KLHT_NT, COT1234514.KHVKD,COT6.KLHT,COT1234514.KHVKD_NAM FROM
(SELECT COT123414.MA_CHUONG,COT123414.MA_NGUON_NSNN, COT123414.MA_DVQHNS, COT123414.TEN_DVQHNS, COT123414.MA_NGANHKT, COT123414.TONGSO_LK_NT, COT123414.VONTUCTH_NT, COT123414.VONTUCTH_DC, COT123414.TT_KLHT_NT, COT5.KHVKD,COT123414.KHVKD_NAM FROM
(SELECT COT12314.MA_CHUONG,COT12314.MA_NGUON_NSNN, COT12314.MA_DVQHNS, COT12314.TEN_DVQHNS, COT12314.MA_NGANHKT, COT12314.TONGSO_LK_NT, COT12314.VONTUCTH_NT, COT12314.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12314.KHVKD_NAM FROM
(SELECT COT1214.MA_CHUONG,COT1214.MA_NGUON_NSNN, COT1214.MA_DVQHNS, COT1214.TEN_DVQHNS, COT1214.MA_NGANHKT, COT1214.TONGSO_LK_NT, COT1214.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1214.KHVKD_NAM FROM
(SELECT COT114.MA_CHUONG,COT114.MA_NGUON_NSNN, COT114.MA_DVQHNS, COT114.TEN_DVQHNS, COT114.MA_NGANHKT, COT114.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT114.KHVKD_NAM FROM
(SELECT COT14.MA_CHUONG,COT14.MA_NGUON_NSNN, COT14.MA_DVQHNS, COT14.TEN_DVQHNS, COT14.MA_NGANHKT, COT1.TONGSO_LK_NT, COT14.KHVKD_NAM FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT14 LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS TONGSO_LK_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT1 ON COT14.MA_NGUON_NSNN = COT1.MA_NGUON_NSNN AND COT14.MA_DVQHNS = COT1.MA_DVQHNS AND COT14.MA_NGANHKT = COT1.MA_NGANHKT AND COT14.MA_CHUONG = COT1.MA_CHUONG
GROUP BY COT14.MA_CHUONG,COT14.MA_NGUON_NSNN, COT14.MA_DVQHNS, COT14.TEN_DVQHNS, COT14.MA_NGANHKT, COT1.TONGSO_LK_NT, COT14.KHVKD_NAM) COT114
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VONTUCTH_NT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT2 ON COT114.MA_NGUON_NSNN = COT2.MA_NGUON_NSNN AND COT114.MA_DVQHNS = COT2.MA_DVQHNS AND COT114.MA_NGANHKT = COT2.MA_NGANHKT AND COT114.MA_CHUONG = COT2.MA_CHUONG
GROUP BY COT114.MA_CHUONG,COT114.MA_NGUON_NSNN, COT114.MA_DVQHNS, COT114.TEN_DVQHNS, COT114.MA_NGANHKT, COT114.TONGSO_LK_NT, COT2.VONTUCTH_NT,COT114.KHVKD_NAM) COT1214
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(GIA_TRI_HACH_TOAN),0) AS VONTUCTH_DC FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 = ''03''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT3 ON COT1214.MA_NGUON_NSNN = COT3.MA_NGUON_NSNN AND COT1214.MA_DVQHNS = COT3.MA_DVQHNS AND COT1214.MA_NGANHKT = COT3.MA_NGANHKT AND COT1214.MA_CHUONG = COT3.MA_CHUONG
GROUP BY COT1214.MA_CHUONG,COT1214.MA_NGUON_NSNN, COT1214.MA_DVQHNS, COT1214.TEN_DVQHNS, COT1214.MA_NGANHKT, COT1214.TONGSO_LK_NT, COT1214.VONTUCTH_NT, COT3.VONTUCTH_DC,COT1214.KHVKD_NAM) COT12314
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT, NVL(SUM(ACCOUNTED_CR),0) AS TT_KLHT_NT FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR) DK1 INNER JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_DR) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.ACCOUNTED_CR = DK2.ACCOUNTED_DR AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT4 ON COT12314.MA_NGUON_NSNN = COT4.MA_NGUON_NSNN AND COT12314.MA_DVQHNS = COT4.MA_DVQHNS AND COT12314.MA_NGANHKT = COT4.MA_NGANHKT AND COT12314.MA_CHUONG = COT4.MA_CHUONG
GROUP BY COT12314.MA_CHUONG,COT12314.MA_NGUON_NSNN, COT12314.MA_DVQHNS, COT12314.TEN_DVQHNS, COT12314.MA_NGANHKT, COT12314.TONGSO_LK_NT, COT12314.VONTUCTH_NT, COT12314.VONTUCTH_DC, COT4.TT_KLHT_NT,COT12314.KHVKD_NAM) COT123414
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS KHVKD FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''06''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT5 ON COT123414.MA_NGUON_NSNN = COT5.MA_NGUON_NSNN AND COT123414.MA_DVQHNS = COT5.MA_DVQHNS AND COT123414.MA_NGANHKT = COT5.MA_NGANHKT AND COT123414.MA_CHUONG = COT5.MA_CHUONG
GROUP BY COT123414.MA_CHUONG,COT123414.MA_NGUON_NSNN, COT123414.MA_DVQHNS, COT123414.TEN_DVQHNS, COT123414.MA_NGANHKT, COT123414.TONGSO_LK_NT, COT123414.VONTUCTH_NT, COT123414.VONTUCTH_DC, COT123414.TT_KLHT_NT, COT5.KHVKD,COT123414.KHVKD_NAM) COT1234514
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHT FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT6 ON COT1234514.MA_NGUON_NSNN = COT6.MA_NGUON_NSNN AND COT1234514.MA_DVQHNS = COT6.MA_DVQHNS AND COT1234514.MA_NGANHKT = COT6.MA_NGANHKT AND COT1234514.MA_CHUONG = COT6.MA_CHUONG
GROUP BY COT1234514.MA_CHUONG,COT1234514.MA_NGUON_NSNN, COT1234514.MA_DVQHNS, COT1234514.TEN_DVQHNS, COT1234514.MA_NGANHKT, COT1234514.TONGSO_LK_NT, COT1234514.VONTUCTH_NT, COT1234514.VONTUCTH_DC, COT1234514.TT_KLHT_NT, COT1234514.KHVKD,COT6.KLHT,COT1234514.KHVKD_NAM) COT12345614
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN, A.MA_DVQHNS, A.TEN_DVQHNS, A.MA_NGANHKT, (CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR
FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT, AB.ACCOUNTED_DR)DT ON 
CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT7 ON COT12345614.MA_NGUON_NSNN = COT7.MA_NGUON_NSNN AND COT12345614.MA_DVQHNS = COT7.MA_DVQHNS AND COT12345614.MA_NGANHKT = COT7.MA_NGANHKT AND COT12345614.MA_CHUONG = COT7.MA_CHUONG
GROUP BY COT12345614.MA_CHUONG,COT12345614.MA_NGUON_NSNN, COT12345614.MA_DVQHNS, COT12345614.TEN_DVQHNS, COT12345614.MA_NGANHKT, COT12345614.TONGSO_LK_NT, COT12345614.VONTUCTH_NT, COT12345614.VONTUCTH_DC, COT12345614.TT_KLHT_NT, COT12345614.KHVKD,COT12345614.KLHT,COT7.HOANUNG,COT12345614.KHVKD_NAM) COT123456714
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_CR-ACCOUNTED_DR),0) AS VTUCTH FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT8 ON COT123456714.MA_NGUON_NSNN = COT8.MA_NGUON_NSNN AND COT123456714.MA_DVQHNS = COT8.MA_DVQHNS AND COT123456714.MA_NGANHKT = COT8.MA_NGANHKT AND COT123456714.MA_CHUONG = COT8.MA_CHUONG
GROUP BY COT123456714.MA_CHUONG,COT123456714.MA_NGUON_NSNN, COT123456714.MA_DVQHNS, COT123456714.TEN_DVQHNS, COT123456714.MA_NGANHKT, COT123456714.TONGSO_LK_NT, COT123456714.VONTUCTH_NT, COT123456714.VONTUCTH_DC, COT123456714.TT_KLHT_NT, COT123456714.KHVKD,COT123456714.KLHT,COT123456714.HOANUNG, COT8.VTUCTH,COT123456714.KHVKD_NAM) COT1234567814
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KHVNS FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') 
AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT9 ON COT1234567814.MA_NGUON_NSNN = COT9.MA_NGUON_NSNN AND COT1234567814.MA_DVQHNS = COT9.MA_DVQHNS AND COT1234567814.MA_NGANHKT = COT9.MA_NGANHKT AND COT1234567814.MA_CHUONG = COT9.MA_CHUONG
GROUP BY COT1234567814.MA_CHUONG,COT1234567814.MA_NGUON_NSNN, COT1234567814.MA_DVQHNS, COT1234567814.TEN_DVQHNS, COT1234567814.MA_NGANHKT, COT1234567814.TONGSO_LK_NT, COT1234567814.VONTUCTH_NT, COT1234567814.VONTUCTH_DC, COT1234567814.TT_KLHT_NT, COT1234567814.KHVKD,COT1234567814.KLHT,COT1234567814.HOANUNG, COT1234567814.VTUCTH, COT9.KHVNS,COT1234567814.KHVKD_NAM) COT12345678914
LEFT JOIN
(SELECT DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT,(NVL(SUM(DK1.T1),0) + NVL(SUM(DK2.T2),0)) AS KHDTN FROM
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR - ACCOUNTED_CR),0) AS T1
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''01''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK1 FULL JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS T2
FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE (''01012016'', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''02''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) DK2 ON DK1.MA_NGUON_NSNN = DK2.MA_NGUON_NSNN AND DK1.MA_DVQHNS = DK2.MA_DVQHNS AND DK1.TEN_DVQHNS = DK2.TEN_DVQHNS AND DK1.MA_NGANHKT = DK2.MA_NGANHKT AND DK1.MA_CHUONG = DK2.MA_CHUONG
GROUP BY DK1.MA_CHUONG,DK1.MA_NGUON_NSNN,DK1.MA_DVQHNS,DK1.TEN_DVQHNS,DK1.MA_NGANHKT) COT10 ON COT12345678914.MA_NGUON_NSNN = COT10.MA_NGUON_NSNN AND COT12345678914.MA_DVQHNS = COT10.MA_DVQHNS AND COT12345678914.MA_NGANHKT = COT10.MA_NGANHKT AND COT12345678914.MA_CHUONG = COT10.MA_CHUONG
GROUP BY COT12345678914.MA_CHUONG,COT12345678914.MA_NGUON_NSNN, COT12345678914.MA_DVQHNS, COT12345678914.TEN_DVQHNS, COT12345678914.MA_NGANHKT, COT12345678914.TONGSO_LK_NT, COT12345678914.VONTUCTH_NT, COT12345678914.VONTUCTH_DC, COT12345678914.TT_KLHT_NT, COT12345678914.KHVKD,COT12345678914.KLHT,COT12345678914.HOANUNG, COT12345678914.VTUCTH, COT12345678914.KHVNS, COT10.KHDTN,COT12345678914.KHVKD_NAM) COT1234567891014
LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS KLHTN FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'')
AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'')  AND MA_TKTN LIKE ''8%''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT11 ON COT1234567891014.MA_NGUON_NSNN = COT11.MA_NGUON_NSNN AND COT1234567891014.MA_DVQHNS = COT11.MA_DVQHNS AND COT1234567891014.MA_NGANHKT = COT11.MA_NGANHKT AND COT1234567891014.MA_CHUONG = COT11.MA_CHUONG
GROUP BY COT1234567891014.MA_CHUONG,COT1234567891014.MA_NGUON_NSNN, COT1234567891014.MA_DVQHNS, COT1234567891014.TEN_DVQHNS, COT1234567891014.MA_NGANHKT, COT1234567891014.TONGSO_LK_NT, COT1234567891014.VONTUCTH_NT, COT1234567891014.VONTUCTH_DC, COT1234567891014.TT_KLHT_NT, COT1234567891014.KHVKD,COT1234567891014.KLHT,COT1234567891014.HOANUNG, COT1234567891014.VTUCTH, COT1234567891014.KHVNS, COT1234567891014.KHDTN, COT11.KLHTN,COT1234567891014.KHVKD_NAM) COT123456789101114
LEFT JOIN
(SELECT CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT,NVL(SUM(CHI.ACCOUNTED_CR),0) AS HOANUNG_NAM FROM  
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,ACCOUNTED_CR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''1713''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT ,ACCOUNTED_CR)CHI INNER JOIN 
(SELECT AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR FROM (SELECT A.MA_CHUONG,A.MA_NGUON_NSNN,A.MA_DVQHNS,A.TEN_DVQHNS,A.MA_NGANHKT,(CASE WHEN B.ACCOUNTED_DR < 0 THEN 0 ELSE A.ACCOUNTED_DR END) AS ACCOUNTED_DR FROM 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR > 0)A LEFT JOIN
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT, ACCOUNTED_DR FROM PHA_HACHTOAN_CHI WHERE NGAY_HIEU_LUC >= TO_DATE ('''||to_char(TUNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''||to_char(DENNGAY_HL,'ddMMyyyy')||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''||to_char(TUNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND
NGAY_KET_SO <= TO_DATE ('''||to_char(DENNGAY_KS,'ddMMyyyy')||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''8%'' AND ACCOUNTED_DR < 0)B
ON A.MA_NGUON_NSNN = B.MA_NGUON_NSNN AND A.MA_DVQHNS = B.MA_DVQHNS AND A.MA_NGANHKT = B.MA_NGANHKT AND A.MA_CHUONG = B.MA_CHUONG AND A.TEN_DVQHNS = B.TEN_DVQHNS AND ABS(A.ACCOUNTED_DR) = ABS(B.ACCOUNTED_DR))AB
GROUP BY AB.MA_CHUONG,AB.MA_NGUON_NSNN,AB.MA_DVQHNS,AB.TEN_DVQHNS,AB.MA_NGANHKT,AB.ACCOUNTED_DR)DT ON CHI.MA_DVQHNS = DT.MA_DVQHNS AND CHI.ACCOUNTED_CR = DT.ACCOUNTED_DR AND CHI.MA_NGUON_NSNN = DT.MA_NGUON_NSNN AND CHI.MA_NGANHKT = DT.MA_NGANHKT AND CHI.MA_CHUONG = DT.MA_CHUONG
GROUP BY CHI.MA_CHUONG,CHI.MA_NGUON_NSNN,CHI.MA_DVQHNS,CHI.TEN_DVQHNS,CHI.MA_NGANHKT) COT12 ON COT123456789101114.MA_NGUON_NSNN = COT12.MA_NGUON_NSNN AND COT123456789101114.MA_DVQHNS = COT12.MA_DVQHNS AND COT123456789101114.MA_NGANHKT = COT12.MA_NGANHKT AND COT123456789101114.MA_CHUONG = COT12.MA_CHUONG
GROUP BY COT123456789101114.MA_CHUONG,COT123456789101114.MA_NGUON_NSNN, COT123456789101114.MA_DVQHNS, COT123456789101114.TEN_DVQHNS, COT123456789101114.MA_NGANHKT, COT123456789101114.TONGSO_LK_NT, COT123456789101114.VONTUCTH_NT, COT123456789101114.VONTUCTH_DC, COT123456789101114.TT_KLHT_NT, COT123456789101114.KHVKD,COT123456789101114.KLHT,COT123456789101114.HOANUNG, COT123456789101114.VTUCTH, COT123456789101114.KHVNS, COT123456789101114.KHDTN, COT123456789101114.KLHTN, COT12.HOANUNG_NAM,COT123456789101114.KHVKD_NAM) COT12345678910111214
LEFT JOIN 
(SELECT MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT,NVL(SUM(ACCOUNTED_DR),0) AS VTUCTH_NAM FROM PHA_DUTOAN WHERE NGAY_HIEU_LUC >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND
NGAY_HIEU_LUC <= TO_DATE ('''|| '3112'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO >= TO_DATE ('''|| '0101'||NAM_TRUOC||''', ''ddMMyyyy'') AND NGAY_KET_SO <= TO_DATE ('''|| '3112'||NAM_SAU||''', ''ddMMyyyy'') AND MA_TKTN LIKE ''95%'' AND ATTRIBUTE8 LIKE ''04''
GROUP BY MA_CHUONG,MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT) COT13 ON COT12345678910111214.MA_NGUON_NSNN = COT13.MA_NGUON_NSNN AND COT12345678910111214.MA_DVQHNS = COT13.MA_DVQHNS AND COT12345678910111214.MA_NGANHKT = COT13.MA_NGANHKT AND COT12345678910111214.MA_CHUONG = COT13.MA_CHUONG
GROUP BY COT12345678910111214.MA_CHUONG,COT12345678910111214.MA_NGUON_NSNN, COT12345678910111214.MA_DVQHNS, COT12345678910111214.TEN_DVQHNS, COT12345678910111214.MA_NGANHKT, COT12345678910111214.TONGSO_LK_NT, COT12345678910111214.VONTUCTH_NT, COT12345678910111214.VONTUCTH_DC, COT12345678910111214.TT_KLHT_NT, COT12345678910111214.KHVKD,COT12345678910111214.KLHT,COT12345678910111214.HOANUNG, COT12345678910111214.VTUCTH, COT12345678910111214.KHVNS, COT12345678910111214.KHDTN, COT12345678910111214.KLHTN, COT12345678910111214.HOANUNG_NAM,COT13.VTUCTH_NAM,COT12345678910111214.KHVKD_NAM)
WHERE MA_DVQHNS LIKE ''7%'' AND MA_CHUONG BETWEEN ''405'' AND ''599'' AND NOT MA_NGUON_NSNN LIKE ''00''
GROUP BY MA_NGUON_NSNN,MA_DVQHNS,TEN_DVQHNS,MA_NGANHKT';

-- DBMS_OUTPUT.ENABLE (buffer_size => NULL);
--      DBMS_OUTPUT.put_line (QUERY_STR1); 

EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT1';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT2';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT3';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT4';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT5';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT6';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT7';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT8';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT9';  
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT10';
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT11'; 
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT12'; 
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT13'; 
EXECUTE IMMEDIATE 'TRUNCATE TABLE PHA_DTBG03_KBQT14'; 

Q_INSERT:= ' INSERT INTO PHA_DTBG03_KBQT1 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR||')';
Q_INSERT_1:= ' INSERT INTO PHA_DTBG03_KBQT2 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR1||')';
Q_INSERT_2:= ' INSERT INTO PHA_DTBG03_KBQT3 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR2||')';
Q_INSERT_3:= ' INSERT INTO PHA_DTBG03_KBQT4 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR3||')';
Q_INSERT_4:= ' INSERT INTO PHA_DTBG03_KBQT5 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR4||')';
Q_INSERT_5:= ' INSERT INTO PHA_DTBG03_KBQT6 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR5||')';
Q_INSERT_6:= ' INSERT INTO PHA_DTBG03_KBQT7 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR6||')';
Q_INSERT_7:= ' INSERT INTO PHA_DTBG03_KBQT8 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR7||')';
Q_INSERT_8:= ' INSERT INTO PHA_DTBG03_KBQT9 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR8||')';
Q_INSERT_9:= ' INSERT INTO PHA_DTBG03_KBQT10 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR9||')';
Q_INSERT_10:= ' INSERT INTO PHA_DTBG03_KBQT11 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR10||')';
Q_INSERT_11:= ' INSERT INTO PHA_DTBG03_KBQT12 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR11||')';
Q_INSERT_12:= ' INSERT INTO PHA_DTBG03_KBQT13 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR12||')';
Q_INSERT_13:= ' INSERT INTO PHA_DTBG03_KBQT14 (MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM) ('||QUERY_STR13||')';

EXECUTE IMMEDIATE Q_INSERT;
EXECUTE IMMEDIATE Q_INSERT_1;
EXECUTE IMMEDIATE Q_INSERT_2;
EXECUTE IMMEDIATE Q_INSERT_3;
EXECUTE IMMEDIATE Q_INSERT_4;
EXECUTE IMMEDIATE Q_INSERT_5;
EXECUTE IMMEDIATE Q_INSERT_6;
EXECUTE IMMEDIATE Q_INSERT_7;
EXECUTE IMMEDIATE Q_INSERT_8;
EXECUTE IMMEDIATE Q_INSERT_9;
EXECUTE IMMEDIATE Q_INSERT_10;
EXECUTE IMMEDIATE Q_INSERT_11;
EXECUTE IMMEDIATE Q_INSERT_12;
EXECUTE IMMEDIATE Q_INSERT_13;

QUERY_STR14:= ' SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT1
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT2
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT3
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT4
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT5
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT6
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT7
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT8
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT9
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT10
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT11
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT12
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT13
    UNION 
    SELECT MA_NGUON_NSNN, MA_DVQHNS,TEN_DVQHNS, MA_NGANHKT,TONGSO_LK_NT,VONTUCTH_NT,VONTUCTH_DC,TT_KLHT_NT,KHVKD, KLHT,VTUCTH, KHVNS, KHDTN, KLHTN,VTUCTH_NAM, KHVKD_NAM FROM PHA_DTBG03_KBQT14
    ORDER BY MA_NGUON_NSNN
    ';
   
BEGIN
OPEN cur FOR QUERY_STR14;
EXCEPTION
   WHEN NO_DATA_FOUND
   THEN
      DBMS_OUTPUT.put_line ('<your message>' || SQLERRM);
   WHEN OTHERS
   THEN
    DBMS_OUTPUT.ENABLE (buffer_size => NULL);
      DBMS_OUTPUT.put_line (SQLERRM); 
END;    
END PHA_DTBG_03_KBQT;